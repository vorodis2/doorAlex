{"code":"!function(t){var e=window.webpackHotUpdate;window.webpackHotUpdate=function(t,i){!function(t,e){if(!_[t]||!T[t])return;for(var i in T[t]=!1,e)Object.prototype.hasOwnProperty.call(e,i)&&(m[i]=e[i]);0==--v&&0===E&&R()}(t,i),e&&e(t,i)};var i,s=!0,n=\"fcf4687d28efa5ee26ca\",r=1e4,a={},o=[],h=[];function l(t){var e=A[t];if(!e)return M;var s=function(s){return e.hot.active?(A[s]?-1===A[s].parents.indexOf(t)&&A[s].parents.push(t):(o=[t],i=s),-1===e.children.indexOf(s)&&e.children.push(s)):(console.warn(\"[HMR] unexpected require(\"+s+\") from disposed module \"+t),o=[]),M(s)},n=function(t){return{configurable:!0,enumerable:!0,get:function(){return M[t]},set:function(e){M[t]=e}}};for(var r in M)Object.prototype.hasOwnProperty.call(M,r)&&\"e\"!==r&&\"t\"!==r&&Object.defineProperty(s,r,n(r));return s.e=function(t){return\"ready\"===d&&p(\"prepare\"),E++,M.e(t).then(e,function(t){throw e(),t});function e(){E--,\"prepare\"===d&&(x[t]||w(t),0===E&&0===v&&R())}},s.t=function(t,e){return 1&e&&(t=s(t)),M.t(t,-2&e)},s}function c(t){var e={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:i!==t,active:!0,accept:function(t,i){if(void 0===t)e._selfAccepted=!0;else if(\"function\"==typeof t)e._selfAccepted=t;else if(\"object\"==typeof t)for(var s=0;s<t.length;s++)e._acceptedDependencies[t[s]]=i||function(){};else e._acceptedDependencies[t]=i||function(){}},decline:function(t){if(void 0===t)e._selfDeclined=!0;else if(\"object\"==typeof t)for(var i=0;i<t.length;i++)e._declinedDependencies[t[i]]=!0;else e._declinedDependencies[t]=!0},dispose:function(t){e._disposeHandlers.push(t)},addDisposeHandler:function(t){e._disposeHandlers.push(t)},removeDisposeHandler:function(t){var i=e._disposeHandlers.indexOf(t);i>=0&&e._disposeHandlers.splice(i,1)},check:y,apply:S,status:function(t){if(!t)return d;u.push(t)},addStatusHandler:function(t){u.push(t)},removeStatusHandler:function(t){var e=u.indexOf(t);e>=0&&u.splice(e,1)},data:a[t]};return i=void 0,e}var u=[],d=\"idle\";function p(t){d=t;for(var e=0;e<u.length;e++)u[e].call(null,t)}var f,m,g,v=0,E=0,x={},T={},_={};function b(t){return+t+\"\"===t?+t:t}function y(t){if(\"idle\"!==d)throw new Error(\"check() is only allowed in idle status\");return s=t,p(\"check\"),(e=r,e=e||1e4,new Promise(function(t,i){if(\"undefined\"==typeof XMLHttpRequest)return i(new Error(\"No browser support\"));try{var s=new XMLHttpRequest,r=M.p+\"\"+n+\".hot-update.json\";s.open(\"GET\",r,!0),s.timeout=e,s.send(null)}catch(t){return i(t)}s.onreadystatechange=function(){if(4===s.readyState)if(0===s.status)i(new Error(\"Manifest request to \"+r+\" timed out.\"));else if(404===s.status)t();else if(200!==s.status&&304!==s.status)i(new Error(\"Manifest request to \"+r+\" failed.\"));else{try{var e=JSON.parse(s.responseText)}catch(t){return void i(t)}t(e)}}})).then(function(t){if(!t)return p(\"idle\"),null;T={},x={},_=t.c,g=t.h,p(\"prepare\");var e=new Promise(function(t,e){f={resolve:t,reject:e}});m={};return w(0),\"prepare\"===d&&0===E&&0===v&&R(),e});var e}function w(t){_[t]?(T[t]=!0,v++,function(t){var e=document.createElement(\"script\");e.charset=\"utf-8\",e.src=M.p+\"\"+t+\".\"+n+\".hot-update.js\",document.head.appendChild(e)}(t)):x[t]=!0}function R(){p(\"ready\");var t=f;if(f=null,t)if(s)Promise.resolve().then(function(){return S(s)}).then(function(e){t.resolve(e)},function(e){t.reject(e)});else{var e=[];for(var i in m)Object.prototype.hasOwnProperty.call(m,i)&&e.push(b(i));t.resolve(e)}}function S(e){if(\"ready\"!==d)throw new Error(\"apply() is only allowed in ready status\");var i,s,r,h,l;function c(t){for(var e=[t],i={},s=e.slice().map(function(t){return{chain:[t],id:t}});s.length>0;){var n=s.pop(),r=n.id,a=n.chain;if((h=A[r])&&!h.hot._selfAccepted){if(h.hot._selfDeclined)return{type:\"self-declined\",chain:a,moduleId:r};if(h.hot._main)return{type:\"unaccepted\",chain:a,moduleId:r};for(var o=0;o<h.parents.length;o++){var l=h.parents[o],c=A[l];if(c){if(c.hot._declinedDependencies[r])return{type:\"declined\",chain:a.concat([l]),moduleId:r,parentId:l};-1===e.indexOf(l)&&(c.hot._acceptedDependencies[r]?(i[l]||(i[l]=[]),u(i[l],[r])):(delete i[l],e.push(l),s.push({chain:a.concat([l]),id:l})))}}}}return{type:\"accepted\",moduleId:t,outdatedModules:e,outdatedDependencies:i}}function u(t,e){for(var i=0;i<e.length;i++){var s=e[i];-1===t.indexOf(s)&&t.push(s)}}e=e||{};var f={},v=[],E={},x=function(){console.warn(\"[HMR] unexpected require(\"+y.moduleId+\") to disposed module\")};for(var T in m)if(Object.prototype.hasOwnProperty.call(m,T)){var y;l=b(T);var w=!1,R=!1,S=!1,H=\"\";switch((y=m[T]?c(l):{type:\"disposed\",moduleId:T}).chain&&(H=\"\\nUpdate propagation: \"+y.chain.join(\" -> \")),y.type){case\"self-declined\":e.onDeclined&&e.onDeclined(y),e.ignoreDeclined||(w=new Error(\"Aborted because of self decline: \"+y.moduleId+H));break;case\"declined\":e.onDeclined&&e.onDeclined(y),e.ignoreDeclined||(w=new Error(\"Aborted because of declined dependency: \"+y.moduleId+\" in \"+y.parentId+H));break;case\"unaccepted\":e.onUnaccepted&&e.onUnaccepted(y),e.ignoreUnaccepted||(w=new Error(\"Aborted because \"+l+\" is not accepted\"+H));break;case\"accepted\":e.onAccepted&&e.onAccepted(y),R=!0;break;case\"disposed\":e.onDisposed&&e.onDisposed(y),S=!0;break;default:throw new Error(\"Unexception type \"+y.type)}if(w)return p(\"abort\"),Promise.reject(w);if(R)for(l in E[l]=m[l],u(v,y.outdatedModules),y.outdatedDependencies)Object.prototype.hasOwnProperty.call(y.outdatedDependencies,l)&&(f[l]||(f[l]=[]),u(f[l],y.outdatedDependencies[l]));S&&(u(v,[y.moduleId]),E[l]=x)}var D,C=[];for(s=0;s<v.length;s++)l=v[s],A[l]&&A[l].hot._selfAccepted&&C.push({module:l,errorHandler:A[l].hot._selfAccepted});p(\"dispose\"),Object.keys(_).forEach(function(t){!1===_[t]&&function(t){delete installedChunks[t]}(t)});for(var P,O,L=v.slice();L.length>0;)if(l=L.pop(),h=A[l]){var I={},N=h.hot._disposeHandlers;for(r=0;r<N.length;r++)(i=N[r])(I);for(a[l]=I,h.hot.active=!1,delete A[l],delete f[l],r=0;r<h.children.length;r++){var B=A[h.children[r]];B&&((D=B.parents.indexOf(l))>=0&&B.parents.splice(D,1))}}for(l in f)if(Object.prototype.hasOwnProperty.call(f,l)&&(h=A[l]))for(O=f[l],r=0;r<O.length;r++)P=O[r],(D=h.children.indexOf(P))>=0&&h.children.splice(D,1);for(l in p(\"apply\"),n=g,E)Object.prototype.hasOwnProperty.call(E,l)&&(t[l]=E[l]);var k=null;for(l in f)if(Object.prototype.hasOwnProperty.call(f,l)&&(h=A[l])){O=f[l];var j=[];for(s=0;s<O.length;s++)if(P=O[s],i=h.hot._acceptedDependencies[P]){if(-1!==j.indexOf(i))continue;j.push(i)}for(s=0;s<j.length;s++){i=j[s];try{i(O)}catch(t){e.onErrored&&e.onErrored({type:\"accept-errored\",moduleId:l,dependencyId:O[s],error:t}),e.ignoreErrored||k||(k=t)}}}for(s=0;s<C.length;s++){var F=C[s];l=F.module,o=[l];try{M(l)}catch(t){if(\"function\"==typeof F.errorHandler)try{F.errorHandler(t)}catch(i){e.onErrored&&e.onErrored({type:\"self-accept-error-handler-errored\",moduleId:l,error:i,originalError:t}),e.ignoreErrored||k||(k=i),k||(k=t)}else e.onErrored&&e.onErrored({type:\"self-accept-errored\",moduleId:l,error:t}),e.ignoreErrored||k||(k=t)}}return k?(p(\"fail\"),Promise.reject(k)):(p(\"idle\"),new Promise(function(t){t(v)}))}var A={};function M(e){if(A[e])return A[e].exports;var i=A[e]={i:e,l:!1,exports:{},hot:c(e),parents:(h=o,o=[],h),children:[]};return t[e].call(i.exports,i,i.exports,l(e)),i.l=!0,i.exports}M.m=t,M.c=A,M.d=function(t,e,i){M.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},M.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},M.t=function(t,e){if(1&e&&(t=M(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(M.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var s in t)M.d(i,s,function(e){return t[e]}.bind(null,s));return i},M.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return M.d(e,\"a\",e),e},M.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},M.p=\"build/\",M.h=function(){return n},l(8)(M.s=8)}([function(t,e,i){\"use strict\";function s(t){this.parent=t;var e,i=this;this._active=!1,this.RADIUS=1e3,this.POS_X=0,this.POS_Y=0,this.POS_Z=0,this.LINK=\"nullMy\",this.COLOR=\"0xffffff\",this._radius=this.RADIUS,this._link=this.LINK,this._color=this.COLOR,this._shadRotZ=this.parent.ROTATION_Z,this._rotZ=0,this._x=this.POS_X,this._y=this.POS_Y,this._z=this.POS_Z,this.mesh=void 0,this.cont3d=void 0,this.cont3d1=void 0,this.textur=void 0,this.loaderHDR=void 0,this.onLoad=void 0,this.onComplete=void 0,this.init=function(){null==this.mesh&&(this.geometry=new THREE.SphereGeometry(1,32,32),this.loader=new THREE.TextureLoader,this.material=new THREE.MeshBasicMaterial({side:THREE.BackSide,color:16777215}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.scale.set(this._radius,this._radius,this._radius),this.cont3d=new THREE.Object3D,this.cont3d1=new THREE.Object3D,this.cont3d.add(this.cont3d1),this.cont3d1.add(this.mesh),this.cont3d1.rotation.y=0,this.mesh.rotation.y=this._rotZ,this.cont3d.rotation.x=-Math.PI/2)},this.dergActiv=function(){1==this._active?null==this.cont3d.parent&&this.parent.parent.groupObject.add(this.cont3d):null!=this.cont3d.parent&&this.parent.parent.groupObject.remove(this.cont3d)},this.canvasTexture,this.linkNull=null,this.creatLink=function(){if(null!=this.linkNull)return this.linkNull;let t=document.createElement(\"canvas\"),e=t.getContext(\"2d\");t.height=t.width=2048;let i=t.height/26;e.fillStyle=\"rgba(100, 100, 100, 0.5)\";let s=!0,n=!0;for(var r=0;r<26;r++){n=s;for(var a=0;a<26;a++)n&&e.fillRect(r*i,a*i,i,i),n=!n;s=!s}this.linkNull=t.toDataURL(\"image/png\"),this.canvasTexture=new THREE.CanvasTexture(t)},this.dergLink=function(){if(\"null\"==this._link||null==this._link){null!=this.material.map&&(this.material.map=null,this.material.needsUpdate=!0);let t=this._link+\"\";this.creatLink(),i.textur=this.canvasTexture,i.textur.linkMy=t,i.material.map=i.textur,i.material.needsUpdate=!0,i.parent.parent.intRend=1,i.onComplete&&i.onComplete()}else{if(this.onLoad&&this.onLoad(),0==(e=this.checkFormat(this._link))){let t=this._link+\"\";if(i.textur&&i.textur.linkMy&&i.textur.linkMy==t)return void(i.onComplete&&i.onComplete());this.loader.load(this._link,function(e){i.textur=e,i.textur.linkMy=t,i.material.map=e,i.material.needsUpdate=!0,i.parent.parent.intRend=1,i.onComplete&&i.onComplete()},function(t){},function(t){})}if(1==e)return}},this.checkFormat=function(t){return-1!==t.indexOf(\".png\")?0:-1!==t.indexOf(\".jpeg\")?0:-1!==t.indexOf(\".jpg\")?0:t.length>150?-1!==t.indexOf(\"png\")?0:-1!==t.indexOf(\"jpeg\")?0:-1!==t.indexOf(\"jpg\")?0:1:1},this.render=function(){}}i.d(e,\"a\",function(){return s}),s.prototype={set x(t){this._x!==t&&(this._x=t,this.cont3d.position.x=t,this.parent.parent.intRend=1)},get x(){return this._x},set y(t){this._y!==t&&(this._y=t,this.cont3d.position.y=t,this.parent.parent.intRend=1)},get y(){return this._y},set z(t){this._z!==t&&(this._z=t,this.cont3d.position.z=t,this.parent.parent.intRend=1)},get z(){return this._z},set active(t){this._active!==t&&(this._active=t,this.init(),this.dergActiv())},get active(){return this._active},set radius(t){this._radius!==t&&(this._radius=t,null!=this.mesh&&this.mesh.scale.set(this._radius,this._radius,this._radius))},get radius(){return this._radius},set link(t){this._link!==t&&(this._link=t,this.init(),this.dergLink())},get link(){return this._link},set color(t){if(this._color!==t){this._color=t,this.init();var e=this._color;if(\"string\"==typeof e&&-1!=e.indexOf(\"x\")){var i=e.split(\"x\");e=\"#\"+i[1]}this.material.color=new THREE.Color(e)}},get color(){return this._color}}},function(t,e,i){\"use strict\";var s=i(4);function n(t){this.type=\"SceneSB\",this.visi3D=t;this.array=[],this.object=void 0,this.array.push(new h(\"ambient\",t)),this.array.push(new o(\"shadow\",t)),this.array.push(new l(\"sky\",t)),this.array.push(new c(\"visi3D\",t)),this.array.push(new u(\"fog\",t)),this.setObj=function(t){this.object=t;for(var e=0;e<this.array.length;e++)void 0===this.object[this.array[e].name]&&(this.object[this.array[e].name]={}),this.array[e].setBasa(this.object[this.array[e].name]);visi3D.shadowNeedsUpdate=!0}}function r(t,e){this.type=\"SceneBox\";this.name=t,this.array=[],this.object=null,this.objArray={},this.plus=function(t,e){this.array.push(new a(t,e)),this.objArray[t.param]=this.array[this.array.length-1]},this.setValue=function(t,e,i){null==i?this.object[t]=e:this.drahKeyParam(t,e)},this.drahKey=function(t){null==this.objArray.works||0!=this.object.works?(null!=this.objArray[t]&&(1==this.objArray[t].tipP&&(\"object\"==typeof this.objArray[t].param[t]?this.objArray[t].param[t]=this.object[t]:this.objArray[t].param[t]!=this.object[t]&&(this.objArray[t].param[t]=this.object[t])),2==this.objArray[t].tipP&&this.objArray[t].param(this.object[t])),e.intRend=1):\"active\"==t&&this.objArray.active.param&&(this.objArray.active.param(this.object.active),e.intRend=1)},this.drahKeyParam=function(t,i){null!=this.objArray[t]&&(1==this.objArray[t].tipP&&(\"object\"==typeof this.objArray[t].param[t]?this.objArray[t].param[t]=i:this.objArray[t].param[t]!=i&&(this.objArray[t].param[t]=i)),2==this.objArray[t].tipP&&this.objArray[t].param(i)),e.intRend=1},this.setBasa=function(t){this.object=t;for(var e=0;e<this.array.length;e++)null==t[this.array[e].object.param]&&(t[this.array[e].object.param]=this.array[e].object.valueStart);this.drahKeys()},this.drahKeys=function(){for(var t=0;t<this.array.length;t++)this.drahKey(this.array[t].object.param)},this.plus({name:\"check10\",typeParam:\"DCheckBox\",param:\"works\",title:\"works//false не работает\",valueStart:!0})}function a(t,e){this.type=\"SceneGron\";this.object=t,this.param=e,this.tipP=0,null!=e&&(\"object\"==typeof e&&(this.tipP=1),\"function\"==typeof e&&(this.tipP=2))}function o(t,e){r.call(this,t,e),this.type=\"SceneBox1\";this.plus({name:\"check\",typeParam:\"DCheckBox\",param:\"active\",title:\"active\",valueStart:!1},function(t){e.utility.sunActiv(t)}),this.plus({name:\"slider10\",typeParam:\"DSliderBig\",param:\"mapSize\",title:\"mapSize\",min:64,max:8192,value:2048,okrug:1,valueStart:e.SHADOW_WH},function(t){t=t||e.SHADOW_WH,e.sunLight.shadow.mapSize.width!=t&&(e.sunLight.shadow.mapSize.width=t,e.sunLight.shadow.mapSize.height=t)}),this.plus({name:\"color\",typeParam:\"DColor\",param:\"color\",title:\"color\",valueStart:e.LIGHT_COLOR},function(t){var i=t;if(\"string\"==typeof i&&-1!=i.indexOf(\"x\")){var s=i.split(\"x\");i=\"#\"+s[1]}e.sunLight.color=new THREE.Color(i)}),this.plus({name:\"slider\",typeParam:\"DSliderBig\",param:\"bias\",title:\"bias\",min:-.05,max:.05,value:0,okrug:1e4,valueStart:e.LIGHT_BIAS},e.sunLight.shadow),this.plus({name:\"slider1\",typeParam:\"DSliderBig\",param:\"intensity\",title:\"intensity\",min:0,max:5,value:1,okrug:100,valueStart:e.SHADOW_INTENSITY},e.sunLight),this.plus({name:\"slider2\",typeParam:\"DSliderBig\",param:\"radius\",title:\"radius\",min:0,max:50,value:1,valueStart:e.SHADOW_RADIUS},e.sunLight.shadow),this.plus({name:\"check2\",typeParam:\"DCheckBox\",param:\"bAlphaForCoating\",title:\"SAMPLE_ALPHA..\",value:!0,valueStart:!1},function(t){var i=e.renderer.getContext();t?i.enable(i.SAMPLE_ALPHA_TO_COVERAGE):i.disable(i.SAMPLE_ALPHA_TO_COVERAGE)}),this.plus({name:\"check3\",typeParam:\"DCheckBox\",param:\"fixation\",title:\"fixation\",value:!1,valueStart:e.utility.FIXATION},e.utility),this.plus({name:\"slider4\",typeParam:\"DSliderBig\",param:\"rotationX\",title:\"rotationX\",min:-Math.PI,max:Math.PI,okrug:100,value:0,valueStart:e.utility.ROTATION_X},e.utility),this.plus({name:\"slider5\",typeParam:\"DSliderBig\",param:\"rotationZ\",title:\"rotationZ\",min:-Math.PI,max:Math.PI,okrug:100,value:0,valueStart:e.utility.ROTATION_Z},e.utility),this.plus({name:\"slider6\",typeParam:\"DSliderBig\",param:\"distance\",title:\"distance\",min:0,max:1e4,value:0,valueStart:e.utility.DISTANCE},e.utility),this.plus({name:\"slider7\",typeParam:\"DSliderBig\",param:\"cubWidth\",title:\"cubWidth\",min:10,max:1e4,value:0,valueStart:e.utility.CUB_WIDTH},e.utility),this.plus({name:\"slider8\",typeParam:\"DSliderBig\",param:\"cubHeight\",title:\"cubHeight\",min:10,max:1e4,value:0,valueStart:e.utility.CUB_HEIGHT},e.utility),this.plus({name:\"slider9\",typeParam:\"DSliderBig\",param:\"distanceUpdateShadow\",title:\"distUpdateShadow \",min:-1,max:500,value:0,valueStart:e.utility.distanceUpdateShadow},e.utility)}function h(t,e){r.call(this,t,e);var i=this;this.type=\"SceneBox2\",this.plus({name:\"check\",typeParam:\"DCheckBox\",param:\"active\",title:\"active\",valueStart:!0},function(t){e.utility.ambientActiv(t)}),this.plus({name:\"color\",typeParam:\"DColor\",param:\"color\",title:\"color\",tipParam:2,valueStart:e.AMBIEN_COLOR},function(t){var s=t;if(\"string\"==typeof s&&-1!=s.indexOf(\"x\")){var n=s.split(\"x\");s=\"#\"+n[1]}i.setValue(this.object.param,s),e.ambientLight.color=new THREE.Color(s)}),this.plus({name:\"slider\",typeParam:\"DSliderBig\",param:\"intensity\",title:\"intensity\",min:0,max:5,okrug:100,valueStart:e.AMBIEN_INTENSITY},e.ambientLight)}function l(t,e){r.call(this,t,e),this.type=\"SceneBox3\";this.plus({name:\"check\",typeParam:\"DCheckBox\",param:\"active\",title:\"active\",valueStart:!1},function(t){e.utility.sky.active=t}),this.plus({name:\"color\",typeParam:\"DColor\",param:\"color\",title:\"color\",valueStart:e.utility.sky.COLOR},e.utility.sky),this.plus({name:\"contLoader\",typeParam:\"DVisualLoader\",param:\"link\",title:\"LoadPic\",valueStart:e.utility.sky.LINK},e.utility.sky),this.plus({name:\"slider\",typeParam:\"DSliderBig\",param:\"radius\",title:\"radius\",min:10,max:15e3,okrug:1,valueStart:e.utility.sky.RADIUS},e.utility.sky)}function c(t,e){r.call(this,t,e),this.type=\"SceneBox6\";var i=this;this.plus({name:\"check0\",typeParam:\"DCheckBox\",param:\"alwaysRender\",title:\"autoRender\",valueStart:!1},function(t){e.alwaysRender!==t&&(e.alwaysRender=t)}),this.plus({name:\"slider\",typeParam:\"DSliderBig\",param:\"fov\",title:\"fov\",min:0,max:90,okrug:1,valueStart:e.FOV}),this.plus({name:\"slider1\",typeParam:\"DSliderBig\",param:\"far\",title:\"far\",min:100,max:5e4,okrug:1,valueStart:e.FAR},function(t){e.camera.far!=t&&(e.camera.far=t,e.camera.updateProjectionMatrix())}),this.plus({name:\"slider2\",typeParam:\"DSliderBig\",param:\"minZum\",title:\"minZum\",min:0,max:2e4,okrug:1,valueStart:0},function(t){e.minZum=t,e.minZum>e.maxZum&&(e.maxZum=e.minZum,i.setValue(\"maxZum\",t))}),this.plus({name:\"slider3\",typeParam:\"DSliderBig\",param:\"maxZum\",title:\"maxZum\",min:0,max:2e4,okrug:1,valueStart:2e4},function(t){e.maxZum=t,e.maxZum<e.minZum&&(e.minZum=e.maxZum,i.setValue(\"minZum\",t))}),this.plus({name:\"slider4\",typeParam:\"DSliderBig\",param:\"zume\",title:\"powerZum\",min:1,max:2e4,okrug:1,valueStart:250}),this.plus({name:\"slider11\",typeParam:\"DSliderBig\",param:\"powerZum\",title:\"zoom\",min:1,max:100,okrug:1,valueStart:50},function(t){e.position3d.powerZum!==t&&(e.position3d.powerZum=t)}),this.plus({name:\"slider5\",typeParam:\"DSliderBig\",param:\"minRotationX\",title:\"minAngel\",min:0,max:3,okrug:100,valueStart:2.5},function(t){e.minRotationX!==t&&(e.minRotationX=t)}),this.plus({name:\"slider6\",typeParam:\"DSliderBig\",param:\"maxRotationX\",title:\"maxAngel\",min:0,max:3,okrug:100,valueStart:0},function(t){e.maxRotationX!==t&&(e.maxRotationX=t)}),this.plus({name:\"check1\",typeParam:\"DCheckBox\",param:\"debug\",title:\"debug\",valueStart:!0},function(t){e.utility.debug!==t&&(e.utility.debug=t)}),this.plus({name:\"check2\",typeParam:\"DCheckBox\",param:\"isDragPan\",title:\"isDragPan\",valueStart:!0},function(t){e.position3d.isDragPan!==t&&(e.position3d.isDragPan=t)}),this.plus({name:\"check3\",typeParam:\"DCheckBox\",param:\"alphaAd\",title:\"alpha Админ для фотки\",valueStart:!1}),this.plus({name:\"slider7\",typeParam:\"DSliderBig\",param:\"zume\",title:\"zoom\",min:5,max:2e3,okrug:100,valueStart:250},function(t){e.zume=t}),this.plus({name:\"slider8\",typeParam:\"DSliderBig\",param:\"rotationX\",title:\"rotationX\",min:-Math.PI,max:Math.PI,okrug:100,valueStart:0},function(t){e.rotationX=t}),this.plus({name:\"slider9\",typeParam:\"DSliderBig\",param:\"rotationZ\",title:\"rotationZ\",min:-Math.PI,max:Math.PI,okrug:100,valueStart:0},function(t){e.rotationZ=t}),this.plus({name:\"slider10\",typeParam:\"DSliderBig\",param:\"globZ\",title:\"globZ\",min:-1e3,max:1e3,okrug:100,valueStart:0},function(t){e.yVerh=t})}function u(t,e){r.call(this,t,e),this.type=\"SceneBox9\";e.sbfog=new d(e),this.plus({name:\"check\",typeParam:\"DCheckBox\",param:\"active\",title:\"active\",valueStart:!1},function(t){e.sbfog.active=t}),this.plus({name:\"color1\",typeParam:\"DColor\",param:\"color\",title:\"outlineColor1\",valueStart:e.sbfog._color},function(t){var i=t;e.sbfog.color=i}),this.plus({name:\"slider1\",typeParam:\"DSliderBig\",param:\"near\",title:\"near\",min:0,max:1e4,okrug:1,valueStart:50},e.sbfog),this.plus({name:\"slider2\",typeParam:\"DSliderBig\",param:\"far\",title:\"far\",min:0,max:2e4,okrug:1,valueStart:100},e.sbfog)}function d(t){this._active=!1,this._color=\"#ffffff\",this._near=50,this._far=1e3,this.visi=t,this.fog=new THREE.Fog(this._color,this._near,this._far)}d.prototype={set active(t){this._active!=t&&(this._active=t,1==this._active?this.visi.scene.fog=this.fog:this.visi.scene.fog=null)},get active(){return this._active},set color(t){this._color!=t&&(this._color=t,this.fog.color=new THREE.Color(t))},get color(){return this._color},set near(t){this._near!=t&&(this._near=t,this.fog.near=t)},get near(){return this._near},set far(t){this._far!=t&&(this._far=t,this.fog.far=t)},get far(){return this._far}};class p extends DGallery{constructor(t,e,i,s,n){super(t,e,i,s),this.par=n,this.param=n.param,this.type=\"GalleryII\";this.createZamen=function(){var t=new f(this.content,0,0,this.downBtn,this);return t.whPic=this.whPic,t._widthPic=this._widthPic,t._heightPic=this._heightPic,t}}}class f extends DBox{constructor(t,e,i,s,n){super(t,e,i,s),this.par=n,this.param=n.param;var r=this;this.uuid=Math.random(),this.label.fontSize=dcmParam.fontSize,this.label1=new DLabel(this,0,0,\" \"),this.label1.fontSize=dcmParam.fontSizeLitte,this.label2=new DLabel(this,0,0,\" \"),this.label2.fontSize=dcmParam.fontSizeLitte,this.label2.textAlign=\"right\",this.dragInfo=function(){this.label.text=this.object.name,this.label1.text=this.object.title,this.label2.text=this.object.array.length+\" шт.\",this.image.link=this.object.icon,this.label.visible=!0},this.startLoad=function(t){this.object=t,this.dragInfo(),this.draw(),r.funLoad()},this.draw=function(){this.image.width=this._height-2,this.image.height=this._height-2,this.image.x=1,this.image.y=1,this.label.x=this._height+2,this.label.y=1,this.label1.x=this._height+2,this.label1.y=2+dcmParam.fontSize,this.label1.width=this._width-this.label1.x-2,this.label2.width=this._width-2},this.tweenA=void 0,this.animat=function(){null==this.tweenA&&(this.tweenA=new TWEEN.Tween(this)),this.alpha=.7,this.tweenA.to({alpha:1},200).start()}}}class m{constructor(t,e){this.type=\"GLeft\";var i,s,n=this;this.par=t,this.fun=e,this.param=this.par.param,this._activeObject=null,this.dCont=new DCont(this.par.dCont),this.array=[],this._index=-1,this._id=-1,this.width=this.param.sizeBase,this.height=2*this.param.sizeBase,this.init=function(){this.panel=new DPanel(this.dCont,this.param.otstup,this.param.otstup),this.panel.width=this.width,this.panel.height=this.height;let t=this.param.otstup,e=[17,18,19],i=(this.width-this.param.otstup)/e.length-this.param.otstup;for(var s=0;s<e.length;s++){let r=new DButton(this.panel,this.param.otstup+(this.param.otstup+i)*s,t,e[s],function(){n.fun(\"openId\",this.id)});r.id=e[s],r.width=i}t+=this.param.otstup+32,this.gallery=new p(this.panel,this.param.otstup,t,function(t,e,i){let s=this.array[this.index].object.array;n.fun(\"openArray\",s)},this),this.gallery.kolII=1,this.gallery.otstup=this.param.otstup,this.gallery.width=this.width-2*this.param.otstup,this.gallery.heightPic=this.param.wh1,this.gallery.widthPic=this.gallery.width-2*this.param.otstup,this.gallery.height=this.height-t-this.param.otstup},this.array=[],this.object,this.addObj=function(t){for(var e in this.object=t,this.array=[],this.object)this.array.push(this.object[e]);this.gallery.start(this.array)},this.downGroup=function(t){for(var e=0;e<this.gallery.array.length;e++)if(this.gallery.array[e].object.key==t.key)return void(this.gallery.index=e)},this.overGroup=function(t){for(var e=0;e<this.gallery.array.length;e++)if(this.gallery.array[e].object.key==t.key)return void this.gallery.array[e].animat()},this.sizeWin=function(t,e){t&&(i=t,s=e);for(var r=0;r<n.array.length;r++)n.array[r].sizeWin(i-(3*n.param.otstup+n.param.wh),s-2*n.param.otstup)},this.init()}set index(t){if(this._index!=t){this._index=t;for(var e=0;e<this.array.length;e++)this._index==e?this.array[e].active=!0:this.array[e].active=!1;this.dragSS()}}get index(){return this._index}set activeObject(t){if(this._activeObject!=t){this._activeObject=t;for(var e=0;e<this.array.length;e++)this.array[e].activeObject=t}}get activeObject(){return this._activeObject}}class g{constructor(){this.type=\"Param\",this.param={},this.param.color=\"#008cba\",this.param.colorFont=\"#ffffff\",this.param.color1=\"#999999\",this.param.colorActive=\"#f28044\",this.param.otstup=5,this.param.otMy=10,this.param.wh=40,this.param.wh2=32,this.param.wb=150,this.param.sizeBase=292,this.param.sizeBase2=200,this.param.mobile=!1,this.param.whb=32,this.param.whCr=840,this.param.fontSize=16,this.param.fontSize1=24,this.param.fontSizeLittel=10,this.param.debug=!1,this.param.bRadius=24,this.param.whPic=256,this.param.kolVolid=10,this.param.fontFamily=\"Montserrat\",this.param.maxW=350,this.param.maxH=350,this.param.borderRadius=0,this.param.glowColor=\"#979797\",this.param.glowSah=0,this.param.host=\"https://xz.ru/\",this.param.server=this.param.host+\"api/v1/\",this.param.serverNa=this.param.host+\"www/\",this.param.nameLS=\"___credentials2\",this.param.version_reliz=1,this.param.version_dev=8,this.param.versi=\"v \"+this.param.version_reliz+\".0\"+this.param.version_dev,this.param.token=null,this.param.objects3d=void 0,this.param.materials=void 0,this.param.textures=void 0,this.param.objectBase=void 0,this.param.scenes3d=void 0,this.param.arrayName=[\"objects3d\",\"materials\",\"textures\",\"scenes3d\",\"materials_sorts\",\"objects3d_sorts\"],this.param.parentId=0,this.param.simMani=\"₽\",this.param.objectBase={},this.param.langs=[\"ru\",\"en\"]}}function v(t,e,i,s){DCont.call(this),this.type=\"DVisualLoader\";var n=this;t.add(this),this.fun=s,this._link=\"null\",this._value=this._link,this._width=100,this._height=20,this.otstup=2,this.panel=new DPanel(this,0,0),this.bat=new DButton(this,this.otstup,this.otstup,\"x\",function(){n.value=\"null\",n.fun()}),this._height=2*this.bat.height+3*this.otstup,this.panel.height=this._height,this.bat.width=this.bat.height,this.bat1=new DButton(this,this.panel.height,2*this.otstup+this.bat.height,\"load\",function(t){n.image.visible=!0,n.funGetFile?n.funGetFile(this.files[0],function(t){n.link=t,n.fun&&n.fun()}):(n.input.value=t,n._link=t,n.image.link=t)}),this.bat1.startFile(\".jpg, .png\"),this.input=new DInput(this,this.panel.height,this.otstup,this._link,function(){n.value=this.text,n.fun()}),this.panel1=new DPanel(this,this.otstup,this.otstup),this.panel1.width=this.panel1.height=this.panel.height-2*this.otstup;var r=this.panel1.width-3*this.otstup;this.image=new DImage(this.panel1,this.otstup,this.otstup,null,function(){this.width=r,this.height=r}),this.draw=function(){this.bat.x=this._width-this.bat.width-this.otstup,this.input.width=this._width-this.input.x-this.bat.width-2*this.otstup,this.bat1.width=this._width-this.panel1.width-3*this.otstup},this.draw()}v.prototype=Object.create(DCont.prototype),v.prototype.constructor=v,Object.defineProperties(v.prototype,{width:{set:function(t){this._width!==t&&(this._width=t,this.draw())},get:function(){return this._width}},height:{set:function(t){},get:function(){return this._height}},link:{set:function(t){this._link!==t&&(this._link=t,\"null\"===this.link?(this.image.visible=!1,this.input.value=this.link):this.link===this.linkError?(this.image.link=this.linkError,this.input.value=this.link):(this.image.visible=!0,this.image.link=this._link,this.input.value=this._link))},get:function(){return this._link}},value:{set:function(t){this.link=t},get:function(){return this._link}},title:{set:function(t){this._title!==t&&(this._title=t,this.bat1.text=t)},get:function(){return this._title}}});class E{constructor(t,e){this.type=\"Menu\";var i,s;for(var n in this.par=t,this.fun=e,window.dcmParam=new DCM,this.contHTML=document.createElement(\"div\"),this.contHTML.style.position=\"fixed\",this.contHTML.style.top=\"0px\",this.contHTML.style.left=\"0px\",this.dC=new DCont(this.contHTML),this.dCont=new DCont(this.dC),document.body.appendChild(this.contHTML),this.param=(new g).param,this.param.wh=32,this.param.wh1=64,this.param.wh2=20,this.param.fontSize=16,this.param.fontSizeLitte=12,this.param.otstup=5,this.param.borderRadius=4,this.param.color=\"#05828e\",this.param.color1=\"#202c31\",this.param.colorActive=\"#bdbdbd\",this.param.fontFamily=\"Open Sans\",this.param.sizeBase=3*(this.param.wh1+this.param.otstup)+2*this.param.otstup,this.param)null!=dcmParam[n]&&(dcmParam[n]=this.param[n]);document.body.style.backgroundColor=this.param.color1,this.array=[],this.init=function(){this.array[this.array.length]=this.gLeft=new m(this,function(t,i,s){e(t,i,s)})},this.update=function(){},this.sizeWindow=function(t,e,r){t&&(i=t,s=e,n=r);for(var a=0;a<this.array.length;a++)this.array[a].sizeWindow&&this.array[a].sizeWindow(i,s,n)},this.init()}}function x(t,e){if(e===THREE.TrianglesDrawMode)return console.warn(\"THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.\"),t;if(e===THREE.TriangleFanDrawMode||e===THREE.TriangleStripDrawMode){let i=t.getIndex();if(null===i){const e=[],s=t.getAttribute(\"position\");if(void 0===s)return console.error(\"THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.\"),t;for(let t=0;t<s.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const s=i.count-2,n=[];if(e===THREE.TriangleFanDrawMode)for(let t=1;t<=s;t++)n.push(i.getX(0)),n.push(i.getX(t)),n.push(i.getX(t+1));else for(let t=0;t<s;t++)t%2==0?(n.push(i.getX(t)),n.push(i.getX(t+1)),n.push(i.getX(t+2))):(n.push(i.getX(t+2)),n.push(i.getX(t+1)),n.push(i.getX(t)));n.length/3!==s&&console.error(\"THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.\");const r=t.clone();return r.setIndex(n),r.clearGroups(),r}return console.error(\"THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:\",e),t}class T extends THREE.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new S(t)}),this.register(function(t){return new L(t)}),this.register(function(t){return new I(t)}),this.register(function(t){return new N(t)}),this.register(function(t){return new M(t)}),this.register(function(t){return new H(t)}),this.register(function(t){return new D(t)}),this.register(function(t){return new C(t)}),this.register(function(t){return new R(t)}),this.register(function(t){return new P(t)}),this.register(function(t){return new A(t)}),this.register(function(t){return new O(t)}),this.register(function(t){return new y(t)}),this.register(function(t){return new B(t)}),this.register(function(t){return new k(t)})}load(t,e,i,s){trace(\"urlurlurlurl\",t);const n=this;let r;r=\"\"!==this.resourcePath?this.resourcePath:\"\"!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){s?s(e):console.error(e),n.manager.itemError(t),n.manager.itemEnd(t)},o=new THREE.FileLoader(this.manager);o.setPath(this.path),o.setResponseType(\"arraybuffer\"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(i){try{n.parse(i,r,function(i){e(i),n.manager.itemEnd(t)},a)}catch(t){a(t)}},i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: \"MSFT_texture_dds\" no longer supported. Please update to \"KHR_texture_basisu\".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let n;const r={},a={},o=new TextDecoder;if(\"string\"==typeof t)n=JSON.parse(t);else if(t instanceof ArrayBuffer){if(o.decode(new Uint8Array(t,0,4))===j){try{r[b.KHR_BINARY_GLTF]=new U(t)}catch(t){return void(s&&s(t))}n=JSON.parse(r[b.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(t))}else n=t;if(void 0===n.asset||n.asset.version[0]<2)return void(s&&s(new Error(\"THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.\")));const h=new ut(n,{path:e||this.resourcePath||\"\",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](h);e.name||console.error(\"THREE.GLTFLoader: Invalid plugin found: missing name\"),a[e.name]=e,r[e.name]=!0}if(n.extensionsUsed)for(let t=0;t<n.extensionsUsed.length;++t){const e=n.extensionsUsed[t],i=n.extensionsRequired||[];switch(e){case b.KHR_MATERIALS_UNLIT:r[e]=new w;break;case b.KHR_DRACO_MESH_COMPRESSION:r[e]=new G(n,this.dracoLoader);break;case b.KHR_TEXTURE_TRANSFORM:r[e]=new V;break;case b.KHR_MESH_QUANTIZATION:r[e]=new W;break;default:i.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension \"'+e+'\".')}}h.setExtensions(r),h.setPlugins(a),h.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,n){i.parse(t,e,s,n)})}}function _(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const b={KHR_BINARY_GLTF:\"KHR_binary_glTF\",KHR_DRACO_MESH_COMPRESSION:\"KHR_draco_mesh_compression\",KHR_LIGHTS_PUNCTUAL:\"KHR_lights_punctual\",KHR_MATERIALS_CLEARCOAT:\"KHR_materials_clearcoat\",KHR_MATERIALS_IOR:\"KHR_materials_ior\",KHR_MATERIALS_SHEEN:\"KHR_materials_sheen\",KHR_MATERIALS_SPECULAR:\"KHR_materials_specular\",KHR_MATERIALS_TRANSMISSION:\"KHR_materials_transmission\",KHR_MATERIALS_IRIDESCENCE:\"KHR_materials_iridescence\",KHR_MATERIALS_ANISOTROPY:\"KHR_materials_anisotropy\",KHR_MATERIALS_UNLIT:\"KHR_materials_unlit\",KHR_MATERIALS_VOLUME:\"KHR_materials_volume\",KHR_TEXTURE_BASISU:\"KHR_texture_basisu\",KHR_TEXTURE_TRANSFORM:\"KHR_texture_transform\",KHR_MESH_QUANTIZATION:\"KHR_mesh_quantization\",KHR_MATERIALS_EMISSIVE_STRENGTH:\"KHR_materials_emissive_strength\",EXT_TEXTURE_WEBP:\"EXT_texture_webp\",EXT_TEXTURE_AVIF:\"EXT_texture_avif\",EXT_MESHOPT_COMPRESSION:\"EXT_meshopt_compression\",EXT_MESH_GPU_INSTANCING:\"EXT_mesh_gpu_instancing\"};class y{constructor(t){this.parser=t,this.name=b.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const s=e[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i=\"light:\"+t;let s=e.cache.get(i);if(s)return s;const n=e.json,r=((n.extensions&&n.extensions[this.name]||{}).lights||[])[t];let a;const o=new THREE.Color(16777215);void 0!==r.color&&o.setRGB(r.color[0],r.color[1],r.color[2],THREE.LinearSRGBColorSpace);const h=void 0!==r.range?r.range:0;switch(r.type){case\"directional\":(a=new THREE.DirectionalLight(o)).target.position.set(0,0,-1),a.add(a.target);break;case\"point\":(a=new THREE.PointLight(o)).distance=h;break;case\"spot\":(a=new THREE.SpotLight(o)).distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,a.angle=r.spot.outerConeAngle,a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error(\"THREE.GLTFLoader: Unexpected light type: \"+r.type)}return a.position.set(0,0,0),a.decay=2,rt(a,r),void 0!==r.intensity&&(a.intensity=r.intensity),a.name=e.createUniqueName(r.name||\"light_\"+t),s=Promise.resolve(a),e.cache.add(i,s),s}getDependency(t,e){if(\"light\"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,s=i.json.nodes[t],n=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(t){return i._getNodeRef(e.cache,n,t)})}}class w{constructor(){this.name=b.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(t,e,i){const s=[];t.color=new THREE.Color(1,1,1),t.opacity=1;const n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;t.color.setRGB(e[0],e[1],e[2],THREE.LinearSRGBColorSpace),t.opacity=e[3]}void 0!==n.baseColorTexture&&s.push(i.assignTexture(t,\"map\",n.baseColorTexture,THREE.SRGBColorSpace))}return Promise.all(s)}}class R{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return void 0!==s&&(e.emissiveIntensity=s),Promise.resolve()}}class S{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];if(void 0!==r.clearcoatFactor&&(e.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&n.push(i.assignTexture(e,\"clearcoatMap\",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&n.push(i.assignTexture(e,\"clearcoatRoughnessMap\",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(n.push(i.assignTexture(e,\"clearcoatNormalMap\",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const t=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new THREE.Vector2(t,t)}return Promise.all(n)}}class A{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.iridescenceFactor&&(e.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&n.push(i.assignTexture(e,\"iridescenceMap\",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(e.iridescenceIOR=r.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&n.push(i.assignTexture(e,\"iridescenceThicknessMap\",r.iridescenceThicknessTexture)),Promise.all(n)}}class M{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[];e.sheenColor=new THREE.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;const r=s.extensions[this.name];if(void 0!==r.sheenColorFactor){const t=r.sheenColorFactor;e.sheenColor.setRGB(t[0],t[1],t[2],THREE.LinearSRGBColorSpace)}return void 0!==r.sheenRoughnessFactor&&(e.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&n.push(i.assignTexture(e,\"sheenColorMap\",r.sheenColorTexture,THREE.SRGBColorSpace)),void 0!==r.sheenRoughnessTexture&&n.push(i.assignTexture(e,\"sheenRoughnessMap\",r.sheenRoughnessTexture)),Promise.all(n)}}class H{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.transmissionFactor&&(e.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&n.push(i.assignTexture(e,\"transmissionMap\",r.transmissionTexture)),Promise.all(n)}}class D{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];e.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&n.push(i.assignTexture(e,\"thicknessMap\",r.thicknessTexture)),e.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return e.attenuationColor=(new THREE.Color).setRGB(a[0],a[1],a[2],THREE.LinearSRGBColorSpace),Promise.all(n)}}class C{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class P{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];e.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&n.push(i.assignTexture(e,\"specularIntensityMap\",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return e.specularColor=(new THREE.Color).setRGB(a[0],a[1],a[2],THREE.LinearSRGBColorSpace),void 0!==r.specularColorTexture&&n.push(i.assignTexture(e,\"specularColorMap\",r.specularColorTexture,THREE.SRGBColorSpace)),Promise.all(n)}}class O{constructor(t){this.parser=t,this.name=b.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return void 0!==r.anisotropyStrength&&(e.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(e.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&n.push(i.assignTexture(e,\"anisotropyMap\",r.anisotropyTexture)),Promise.all(n)}}class L{constructor(t){this.parser=t,this.name=b.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],r=e.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error(\"THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures\");return null}return e.loadTextureImage(t,n.source,r)}}class I{constructor(t){this.parser=t,this.name=b.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const r=n.extensions[e],a=s.images[r.source];let o=i.textureLoader;if(a.uri){const t=i.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then(function(n){if(n)return i.loadTextureImage(t,r.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error(\"THREE.GLTFLoader: WebP required by asset but unsupported.\");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src=\"data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA\",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class N{constructor(t){this.parser=t,this.name=b.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const r=n.extensions[e],a=s.images[r.source];let o=i.textureLoader;if(a.uri){const t=i.options.manager.getHandler(a.uri);null!==t&&(o=t)}return this.detectSupport().then(function(n){if(n)return i.loadTextureImage(t,r.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error(\"THREE.GLTFLoader: AVIF required by asset but unsupported.\");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src=\"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=\",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class B{constructor(t){this.name=b.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],s=this.parser.getDependency(\"buffer\",t.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error(\"THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files\");return null}return s.then(function(e){const i=t.byteOffset||0,s=t.byteLength||0,r=t.count,a=t.byteStride,o=new Uint8Array(e,i,s);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(r,a,o,t.mode,t.filter).then(function(t){return t.buffer}):n.ready.then(function(){const e=new ArrayBuffer(r*a);return n.decodeGltfBuffer(new Uint8Array(e),r,a,o,t.mode,t.filter),e})})}return null}}class k{constructor(t){this.name=b.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const s=e.meshes[i.mesh];for(const t of s.primitives)if(t.mode!==Y.TRIANGLES&&t.mode!==Y.TRIANGLE_STRIP&&t.mode!==Y.TRIANGLE_FAN&&void 0!==t.mode)return null;const n=i.extensions[this.name].attributes,r=[],a={};for(const t in n)r.push(this.parser.getDependency(\"accessor\",n[t]).then(e=>(a[t]=e,a[t])));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then(t=>{const e=t.pop(),i=e.isGroup?e.children:[e],s=t[0].count,n=[];for(const t of i){const e=new THREE.Matrix4,i=new THREE.Vector3,r=new THREE.Quaternion,o=new THREE.Vector3(1,1,1),h=new THREE.InstancedMesh(t.geometry,t.material,s);for(let t=0;t<s;t++)a.TRANSLATION&&i.fromBufferAttribute(a.TRANSLATION,t),a.ROTATION&&r.fromBufferAttribute(a.ROTATION,t),a.SCALE&&o.fromBufferAttribute(a.SCALE,t),h.setMatrixAt(t,e.compose(i,r,o));for(const e in a)if(\"_COLOR_0\"===e){const t=a[e];h.instanceColor=new THREE.InstancedBufferAttribute(t.array,t.itemSize,t.normalized)}else\"TRANSLATION\"!==e&&\"ROTATION\"!==e&&\"SCALE\"!==e&&t.geometry.setAttribute(e,a[e]);THREE.Object3D.prototype.copy.call(h,t),this.parser.assignFinalMaterial(h),n.push(h)}return e.isGroup?(e.clear(),e.add(...n),e):n[0]}))}}const j=\"glTF\",F=12,z={JSON:1313821514,BIN:5130562};class U{constructor(t){this.name=b.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,F),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==j)throw new Error(\"THREE.GLTFLoader: Unsupported glTF-Binary header.\");if(this.header.version<2)throw new Error(\"THREE.GLTFLoader: Legacy binary file detected.\");const s=this.header.length-F,n=new DataView(t,F);let r=0;for(;r<s;){const e=n.getUint32(r,!0);r+=4;const s=n.getUint32(r,!0);if(r+=4,s===z.JSON){const s=new Uint8Array(t,F+r,e);this.content=i.decode(s)}else if(s===z.BIN){const i=F+r;this.body=t.slice(i,i+e)}r+=e}if(null===this.content)throw new Error(\"THREE.GLTFLoader: JSON content not found.\")}}class G{constructor(t,e){if(!e)throw new Error(\"THREE.GLTFLoader: No DRACOLoader instance provided.\");this.name=b.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,n=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,a={},o={},h={};for(const t in r){const e=tt[t]||t.toLowerCase();a[e]=r[t]}for(const e in t.attributes){const s=tt[e]||e.toLowerCase();if(void 0!==r[e]){const n=i.accessors[t.attributes[e]],r=Q[n.componentType];h[s]=r.name,o[s]=!0===n.normalized}}return e.getDependency(\"bufferView\",n).then(function(t){return new Promise(function(e){s.decodeDracoFile(t,function(t){for(const e in t.attributes){const i=t.attributes[e],s=o[e];void 0!==s&&(i.normalized=s)}e(t)},a,h)})})}}class V{constructor(){this.name=b.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class W{constructor(){this.name=b.KHR_MESH_QUANTIZATION}}class X extends THREE.Interpolant{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=t*s*3+s;for(let t=0;t!==s;t++)e[t]=i[n+t];return e}interpolate_(t,e,i,s){const n=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=2*a,h=3*a,l=s-e,c=(i-e)/l,u=c*c,d=u*c,p=t*h,f=p-h,m=-2*d+3*u,g=d-u,v=1-m,E=g-u+c;for(let t=0;t!==a;t++){const e=r[f+t+a],i=r[f+t+o]*l,s=r[p+t+a],h=r[p+t]*l;n[t]=v*e+E*i+m*s+g*h}return n}}const Z=new THREE.Quaternion;class K extends X{interpolate_(t,e,i,s){const n=super.interpolate_(t,e,i,s);return Z.fromArray(n).normalize().toArray(n),n}}const Y={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Q={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},q={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},J={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},$={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},tt={POSITION:\"position\",NORMAL:\"normal\",TANGENT:\"tangent\",TEXCOORD_0:\"uv\",TEXCOORD_1:\"uv1\",TEXCOORD_2:\"uv2\",TEXCOORD_3:\"uv3\",COLOR_0:\"color\",WEIGHTS_0:\"skinWeight\",JOINTS_0:\"skinIndex\"},et={scale:\"scale\",translation:\"position\",rotation:\"quaternion\",weights:\"morphTargetInfluences\"},it={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},st={OPAQUE:\"OPAQUE\",MASK:\"MASK\",BLEND:\"BLEND\"};function nt(t,e,i){for(const s in i.extensions)void 0===t[s]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function rt(t,e){void 0!==e.extras&&(\"object\"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn(\"THREE.GLTFLoader: Ignoring primitive type .extras, \"+e.extras))}function at(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,s=e.weights.length;i<s;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,s=i.length;e<s;e++)t.morphTargetDictionary[i[e]]=e}else console.warn(\"THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.\")}}function ot(t){let e;const i=t.extensions&&t.extensions[b.KHR_DRACO_MESH_COMPRESSION];if(e=i?\"draco:\"+i.bufferView+\":\"+i.indices+\":\"+ht(i.attributes):t.indices+\":\"+ht(t.attributes)+\":\"+t.mode,void 0!==t.targets)for(let i=0,s=t.targets.length;i<s;i++)e+=\":\"+ht(t.targets[i]);return e}function ht(t){let e=\"\";const i=Object.keys(t).sort();for(let s=0,n=i.length;s<n;s++)e+=i[s]+\":\"+t[i[s]]+\";\";return e}function lt(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error(\"THREE.GLTFLoader: Unsupported normalized accessor component type.\")}}const ct=new THREE.Matrix4;class ut{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new _,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,n=-1;\"undefined\"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=(s=navigator.userAgent.indexOf(\"Firefox\")>-1)?navigator.userAgent.match(/Firefox\\/([0-9]+)\\./)[1]:-1),\"undefined\"==typeof createImageBitmap||i||s&&n<98?this.textureLoader=new THREE.TextureLoader(this.options.manager):this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType(\"arraybuffer\"),\"use-credentials\"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all(this._invokeAll(function(t){return t.beforeRoot&&t.beforeRoot()})).then(function(){return Promise.all([i.getDependencies(\"scene\"),i.getDependencies(\"animation\"),i.getDependencies(\"camera\")])}).then(function(e){const r={scene:e[0][s.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:s.asset,parser:i,userData:{}};return nt(n,r,s),rt(r,s),Promise.all(i._invokeAll(function(t){return t.afterRoot&&t.afterRoot(r)})).then(function(){t(r)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,s=e.length;i<s;i++){const s=e[i].joints;for(let e=0,i=s.length;e<i;e++)t[s[e]].isBone=!0}for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0!==s.mesh&&(this._addNodeRef(this.meshCache,s.mesh),void 0!==s.skin&&(i[s.mesh].isSkinnedMesh=!0)),void 0!==s.camera&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),n=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,s]of t.children.entries())n(s,e.children[i])};return n(i,s),s.name+=\"_instance_\"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const n=t(e[s]);n&&i.push(n)}return i}getDependency(t,e){const i=t+\":\"+e;let s=this.cache.get(i);if(!s){switch(t){case\"scene\":s=this.loadScene(e);break;case\"node\":s=this._invokeOne(function(t){return t.loadNode&&t.loadNode(e)});break;case\"mesh\":s=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(e)});break;case\"accessor\":s=this.loadAccessor(e);break;case\"bufferView\":s=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(e)});break;case\"buffer\":s=this.loadBuffer(e);break;case\"material\":s=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(e)});break;case\"texture\":s=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(e)});break;case\"skin\":s=this.loadSkin(e);break;case\"animation\":s=this._invokeOne(function(t){return t.loadAnimation&&t.loadAnimation(e)});break;case\"camera\":s=this.loadCamera(e);break;default:if(!(s=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,e)})))throw new Error(\"Unknown type: \"+t)}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(\"mesh\"===t?\"es\":\"s\")]||[];e=Promise.all(s.map(function(e,s){return i.getDependency(t,s)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&\"arraybuffer\"!==e.type)throw new Error(\"THREE.GLTFLoader: \"+e.type+\" buffer type is not supported.\");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[b.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(t,n){i.load(THREE.LoaderUtils.resolveURL(e.uri,s.path),t,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer \"'+e.uri+'\".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency(\"buffer\",e.buffer).then(function(t){const i=e.byteLength||0,s=e.byteOffset||0;return t.slice(s,s+i)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(void 0===s.bufferView&&void 0===s.sparse){const t=$[s.type],e=Q[s.componentType],i=!0===s.normalized,n=new e(s.count*t);return Promise.resolve(new THREE.BufferAttribute(n,t,i))}const n=[];return void 0!==s.bufferView?n.push(this.getDependency(\"bufferView\",s.bufferView)):n.push(null),void 0!==s.sparse&&(n.push(this.getDependency(\"bufferView\",s.sparse.indices.bufferView)),n.push(this.getDependency(\"bufferView\",s.sparse.values.bufferView))),Promise.all(n).then(function(t){const n=t[0],r=$[s.type],a=Q[s.componentType],o=a.BYTES_PER_ELEMENT,h=o*r,l=s.byteOffset||0,c=void 0!==s.bufferView?i.bufferViews[s.bufferView].byteStride:void 0,u=!0===s.normalized;let d,p;if(c&&c!==h){const t=Math.floor(l/c),i=\"InterleavedBuffer:\"+s.bufferView+\":\"+s.componentType+\":\"+t+\":\"+s.count;let h=e.cache.get(i);h||(d=new a(n,t*c,s.count*c/o),h=new THREE.InterleavedBuffer(d,c/o),e.cache.add(i,h)),p=new THREE.InterleavedBufferAttribute(h,r,l%c/o,u)}else d=null===n?new a(s.count*r):new a(n,l,s.count*r),p=new THREE.BufferAttribute(d,r,u);if(void 0!==s.sparse){const e=$.SCALAR,i=Q[s.sparse.indices.componentType],o=s.sparse.indices.byteOffset||0,h=s.sparse.values.byteOffset||0,l=new i(t[1],o,s.sparse.count*e),c=new a(t[2],h,s.sparse.count*r);null!==n&&(p=new THREE.BufferAttribute(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=l.length;t<e;t++){const e=l[t];if(p.setX(e,c[t*r]),r>=2&&p.setY(e,c[t*r+1]),r>=3&&p.setZ(e,c[t*r+2]),r>=4&&p.setW(e,c[t*r+3]),r>=5)throw new Error(\"THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.\")}}return p})}loadTexture(t){const e=this.json,i=this.options,s=e.textures[t].source,n=e.images[s];let r=this.textureLoader;if(n.uri){const t=i.manager.getHandler(n.uri);null!==t&&(r=t)}return this.loadTextureImage(t,s,r)}loadTextureImage(t,e,i){const s=this,n=this.json,r=n.textures[t],a=n.images[e],o=(a.uri||a.bufferView)+\":\"+r.sampler;if(this.textureCache[o])return this.textureCache[o];const h=this.loadImageSource(e,i).then(function(e){e.flipY=!1,e.name=r.name||a.name||\"\",\"\"===e.name&&\"string\"==typeof a.uri&&!1===a.uri.startsWith(\"data:image/\")&&(e.name=a.uri);const i=(n.samplers||{})[r.sampler]||{};return e.magFilter=q[i.magFilter]||THREE.LinearFilter,e.minFilter=q[i.minFilter]||THREE.LinearMipmapLinearFilter,e.wrapS=J[i.wrapS]||THREE.RepeatWrapping,e.wrapT=J[i.wrapT]||THREE.RepeatWrapping,s.associations.set(e,{textures:t}),e}).catch(function(){return null});return this.textureCache[o]=h,h}loadImageSource(t,e){const i=this,s=this.json,n=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then(t=>t.clone());const r=s.images[t],a=self.URL||self.webkitURL;let o=r.uri||\"\",h=!1;if(void 0!==r.bufferView)o=i.getDependency(\"bufferView\",r.bufferView).then(function(t){h=!0;const e=new Blob([t],{type:r.mimeType});return o=a.createObjectURL(e)});else if(void 0===r.uri)throw new Error(\"THREE.GLTFLoader: Image \"+t+\" is missing URI and bufferView\");const l=Promise.resolve(o).then(function(t){return new Promise(function(i,s){let r=i;!0===e.isImageBitmapLoader&&(r=function(t){const e=new THREE.Texture(t);e.needsUpdate=!0,i(e)}),e.load(THREE.LoaderUtils.resolveURL(t,n.path),r,void 0,s)})}).then(function(t){var e;return!0===h&&a.revokeObjectURL(o),t.userData.mimeType=r.mimeType||((e=r.uri).search(/\\.jpe?g($|\\?)/i)>0||0===e.search(/^data\\:image\\/jpeg/)?\"image/jpeg\":e.search(/\\.webp($|\\?)/i)>0||0===e.search(/^data\\:image\\/webp/)?\"image/webp\":\"image/png\"),t}).catch(function(t){throw console.error(\"THREE.GLTFLoader: Couldn't load texture\",o),t});return this.sourceCache[t]=l,l}assignTexture(t,e,i,s){const n=this;return this.getDependency(\"texture\",i.index).then(function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),n.extensions[b.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[b.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=n.associations.get(r);r=n.extensions[b.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),n.associations.set(r,e)}}return void 0!==s&&(r.colorSpace=s),t[e]=r,r})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=void 0===e.attributes.tangent,n=void 0!==e.attributes.color,r=void 0===e.attributes.normal;if(t.isPoints){const t=\"PointsMaterial:\"+i.uuid;let e=this.cache.get(t);e||(e=new THREE.PointsMaterial,Material.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t=\"LineBasicMaterial:\"+i.uuid;let e=this.cache.get(t);e||(e=new THREE.LineBasicMaterial,Material.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,this.cache.add(t,e)),i=e}if(s||n||r){let t=\"ClonedMaterial:\"+i.uuid+\":\";s&&(t+=\"derivative-tangents:\"),n&&(t+=\"vertex-colors:\"),r&&(t+=\"flat-shading:\");let e=this.cache.get(t);e||(e=i.clone(),n&&(e.vertexColors=!0),r&&(e.flatShading=!0),s&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}t.material=i}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(t){const e=this,i=this.json,s=this.extensions,n=i.materials[t];let r;const a={},o=[];if((n.extensions||{})[b.KHR_MATERIALS_UNLIT]){const t=s[b.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),o.push(t.extendParams(a,n,e))}else{const i=n.pbrMetallicRoughness||{};if(a.color=new THREE.Color(1,1,1),a.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;a.color.setRGB(t[0],t[1],t[2],THREE.LinearSRGBColorSpace),a.opacity=t[3]}void 0!==i.baseColorTexture&&o.push(e.assignTexture(a,\"map\",i.baseColorTexture,THREE.SRGBColorSpace)),a.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,a.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(o.push(e.assignTexture(a,\"metalnessMap\",i.metallicRoughnessTexture)),o.push(e.assignTexture(a,\"roughnessMap\",i.metallicRoughnessTexture))),r=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),o.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)})))}!0===n.doubleSided&&(a.side=THREE.DoubleSide);const h=n.alphaMode||st.OPAQUE;if(h===st.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===st.MASK&&(a.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&r!==THREE.MeshBasicMaterial&&(o.push(e.assignTexture(a,\"normalMap\",n.normalTexture)),a.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale)){const t=n.normalTexture.scale;a.normalScale.set(t,t)}if(void 0!==n.occlusionTexture&&r!==THREE.MeshBasicMaterial&&(o.push(e.assignTexture(a,\"aoMap\",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(a.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&r!==THREE.MeshBasicMaterial){const t=n.emissiveFactor;a.emissive=(new THREE.Color).setRGB(t[0],t[1],t[2],THREE.LinearSRGBColorSpace)}return void 0!==n.emissiveTexture&&r!==THREE.MeshBasicMaterial&&o.push(e.assignTexture(a,\"emissiveMap\",n.emissiveTexture,THREE.SRGBColorSpace)),Promise.all(o).then(function(){const i=new r(a);return n.name&&(i.name=n.name),rt(i,n),e.associations.set(i,{materials:t}),n.extensions&&nt(s,i,n),i})}createUniqueName(t){const e=THREE.PropertyBinding.sanitizeNodeName(t||\"\");return e in this.nodeNamesUsed?e+\"_\"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function n(t){return i[b.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then(function(i){return dt(i,t,e)})}const r=[];for(let i=0,a=t.length;i<a;i++){const a=t[i],o=ot(a),h=s[o];if(h)r.push(h.promise);else{let t;t=a.extensions&&a.extensions[b.KHR_DRACO_MESH_COMPRESSION]?n(a):dt(new THREE.BufferGeometry,a,e),s[o]={primitive:a,promise:t},r.push(t)}}return Promise.all(r)}loadMesh(t){const e=this,i=this.json,s=this.extensions,n=i.meshes[t],r=n.primitives,a=[];for(let t=0,e=r.length;t<e;t++){const e=void 0===r[t].material?(void 0===(o=this.cache).DefaultMaterial&&(o.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),o.DefaultMaterial):this.getDependency(\"material\",r[t].material);a.push(e)}var o;return a.push(e.loadGeometries(r)),Promise.all(a).then(function(i){const a=i.slice(0,i.length-1),o=i[i.length-1],h=[];for(let i=0,l=o.length;i<l;i++){const l=o[i],c=r[i];let u;const d=a[i];if(c.mode===Y.TRIANGLES||c.mode===Y.TRIANGLE_STRIP||c.mode===Y.TRIANGLE_FAN||void 0===c.mode)!0===(u=!0===n.isSkinnedMesh?new THREE.SkinnedMesh(l,d):new THREE.Mesh(l,d)).isSkinnedMesh&&u.normalizeSkinWeights(),c.mode===Y.TRIANGLE_STRIP?u.geometry=x(u.geometry,THREE.TriangleStripDrawMode):c.mode===Y.TRIANGLE_FAN&&(u.geometry=x(u.geometry,THREE.TriangleFanDrawMode));else if(c.mode===Y.LINES)u=new THREE.LineSegments(l,d);else if(c.mode===Y.LINE_STRIP)u=new THREE.Line(l,d);else if(c.mode===Y.LINE_LOOP)u=new THREE.LineLoop(l,d);else{if(c.mode!==Y.POINTS)throw new Error(\"THREE.GLTFLoader: Primitive mode unsupported: \"+c.mode);u=new THREE.Points(l,d)}Object.keys(u.geometry.morphAttributes).length>0&&at(u,n),u.name=e.createUniqueName(n.name||\"mesh_\"+t),rt(u,n),c.extensions&&nt(s,u,c),e.assignFinalMaterial(u),h.push(u)}for(let i=0,s=h.length;i<s;i++)e.associations.set(h[i],{meshes:t,primitives:i});if(1===h.length)return n.extensions&&nt(s,h[0],n),h[0];const l=new THREE.Group;n.extensions&&nt(s,l,n),e.associations.set(l,{meshes:t});for(let t=0,e=h.length;t<e;t++)l.add(h[t]);return l})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(s)return\"perspective\"===i.type?e=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):\"orthographic\"===i.type&&(e=new THREE.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),rt(e,i),Promise.resolve(e);console.warn(\"THREE.GLTFLoader: Missing camera parameters.\")}loadSkin(t){const e=this.json.skins[t],i=[];for(let t=0,s=e.joints.length;t<s;t++)i.push(this._loadNodeShallow(e.joints[t]));return void 0!==e.inverseBindMatrices?i.push(this.getDependency(\"accessor\",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(t){const i=t.pop(),s=t,n=[],r=[];for(let t=0,a=s.length;t<a;t++){const a=s[t];if(a){n.push(a);const e=new THREE.Matrix4;null!==i&&e.fromArray(i.array,16*t),r.push(e)}else console.warn('THREE.GLTFLoader: Joint \"%s\" could not be found.',e.joints[t])}return new THREE.Skeleton(n,r)})}loadAnimation(t){const e=this.json,i=this,s=e.animations[t],n=s.name?s.name:\"animation_\"+t,r=[],a=[],o=[],h=[],l=[];for(let t=0,e=s.channels.length;t<e;t++){const e=s.channels[t],i=s.samplers[e.sampler],n=e.target,c=n.node,u=void 0!==s.parameters?s.parameters[i.input]:i.input,d=void 0!==s.parameters?s.parameters[i.output]:i.output;void 0!==n.node&&(r.push(this.getDependency(\"node\",c)),a.push(this.getDependency(\"accessor\",u)),o.push(this.getDependency(\"accessor\",d)),h.push(i),l.push(n))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(h),Promise.all(l)]).then(function(t){const e=t[0],s=t[1],r=t[2],a=t[3],o=t[4],h=[];for(let t=0,n=e.length;t<n;t++){const n=e[t],l=s[t],c=r[t],u=a[t],d=o[t];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();const p=i._createAnimationTracks(n,l,c,u,d);if(p)for(let t=0;t<p.length;t++)h.push(p[t])}return new THREE.AnimationClip(n,void 0,h)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return void 0===s.mesh?null:i.getDependency(\"mesh\",s.mesh).then(function(t){const e=i._getNodeRef(i.meshCache,s.mesh,t);return void 0!==s.weights&&e.traverse(function(t){if(t.isMesh)for(let e=0,i=s.weights.length;e<i;e++)t.morphTargetInfluences[e]=s.weights[e]}),e})}loadNode(t){const e=this,i=this.json.nodes[t],s=e._loadNodeShallow(t),n=[],r=i.children||[];for(let t=0,i=r.length;t<i;t++)n.push(e.getDependency(\"node\",r[t]));const a=void 0===i.skin?Promise.resolve(null):e.getDependency(\"skin\",i.skin);return Promise.all([s,Promise.all(n),a]).then(function(t){const e=t[0],i=t[1],s=t[2];null!==s&&e.traverse(function(t){t.isSkinnedMesh&&t.bind(s,ct)});for(let t=0,s=i.length;t<s;t++)e.add(i[t]);return e})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const n=e.nodes[t],r=n.name?s.createUniqueName(n.name):\"\",a=[],o=s._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(t)});return o&&a.push(o),void 0!==n.camera&&a.push(s.getDependency(\"camera\",n.camera).then(function(t){return s._getNodeRef(s.cameraCache,n.camera,t)})),s._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)}).forEach(function(t){a.push(t)}),this.nodeCache[t]=Promise.all(a).then(function(e){let a;if((a=!0===n.isBone?new THREE.Bone:e.length>1?new THREE.Group:1===e.length?e[0]:new THREE.Object3D)!==e[0])for(let t=0,i=e.length;t<i;t++)a.add(e[t]);if(n.name&&(a.userData.name=n.name,a.name=r),rt(a,n),n.extensions&&nt(i,a,n),void 0!==n.matrix){const t=new THREE.Matrix4;t.fromArray(n.matrix),a.applyMatrix4(t)}else void 0!==n.translation&&a.position.fromArray(n.translation),void 0!==n.rotation&&a.quaternion.fromArray(n.rotation),void 0!==n.scale&&a.scale.fromArray(n.scale);return s.associations.has(a)||s.associations.set(a,{}),s.associations.get(a).nodes=t,a}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,n=new THREE.Group;i.name&&(n.name=s.createUniqueName(i.name)),rt(n,i),i.extensions&&nt(e,n,i);const r=i.nodes||[],a=[];for(let t=0,e=r.length;t<e;t++)a.push(s.getDependency(\"node\",r[t]));return Promise.all(a).then(function(t){for(let e=0,i=t.length;e<i;e++)n.add(t[e]);return s.associations=(t=>{const e=new Map;for(const[t,i]of s.associations)(t instanceof THREE.Material||t instanceof THREE.Texture)&&e.set(t,i);return t.traverse(t=>{const i=s.associations.get(t);null!=i&&e.set(t,i)}),e})(n),n})}_createAnimationTracks(t,e,i,s,n){const r=[],a=t.name?t.name:t.uuid,o=[];let h;switch(et[n.path]===et.weights?t.traverse(function(t){t.morphTargetInfluences&&o.push(t.name?t.name:t.uuid)}):o.push(a),et[n.path]){case et.weights:h=THREE.NumberKeyframeTrack;break;case et.rotation:h=THREE.QuaternionKeyframeTrack;break;case et.position:case et.scale:h=THREE.VectorKeyframeTrack;break;default:switch(i.itemSize){case 1:h=THREE.NumberKeyframeTrack;break;case 2:case 3:default:h=THREE.VectorKeyframeTrack}}const l=void 0!==s.interpolation?it[s.interpolation]:THREE.InterpolateLinear,c=this._getArrayFromAccessor(i);for(let t=0,i=o.length;t<i;t++){const i=new h(o[t]+\".\"+et[n.path],e.array,c,l);\"CUBICSPLINE\"===s.interpolation&&this._createCubicSplineTrackInterpolant(i),r.push(i)}return r}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=lt(e.constructor),i=new Float32Array(e.length);for(let s=0,n=e.length;s<n;s++)i[s]=e[s]*t;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof THREE.QuaternionKeyframeTrack?K:X)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function dt(t,e,i){const s=e.attributes,n=[];function r(e,s){return i.getDependency(\"accessor\",e).then(function(e){t.setAttribute(s,e)})}for(const e in s){const i=tt[e]||e.toLowerCase();i in t.attributes||n.push(r(s[e],i))}if(void 0!==e.indices&&!t.index){const s=i.getDependency(\"accessor\",e.indices).then(function(e){t.setIndex(e)});n.push(s)}return THREE.ColorManagement.workingColorSpace!==THREE.LinearSRGBColorSpace&&\"COLOR_0\"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from \"srgb-linear\" to \"${THREE.ColorManagement.workingColorSpace}\" not supported.`),rt(t,e),function(t,e,i){const s=e.attributes,n=new THREE.Box3;if(void 0===s.POSITION)return;{const t=i.json.accessors[s.POSITION],e=t.min,r=t.max;if(void 0===e||void 0===r)return void console.warn(\"THREE.GLTFLoader: Missing min/max properties for accessor POSITION.\");if(n.set(new THREE.Vector3(e[0],e[1],e[2]),new THREE.Vector3(r[0],r[1],r[2])),t.normalized){const e=lt(Q[t.componentType]);n.min.multiplyScalar(e),n.max.multiplyScalar(e)}}const r=e.targets;if(void 0!==r){const t=new THREE.Vector3,e=new THREE.Vector3;for(let s=0,n=r.length;s<n;s++){const n=r[s];if(void 0!==n.POSITION){const s=i.json.accessors[n.POSITION],r=s.min,a=s.max;if(void 0!==r&&void 0!==a){if(e.setX(Math.max(Math.abs(r[0]),Math.abs(a[0]))),e.setY(Math.max(Math.abs(r[1]),Math.abs(a[1]))),e.setZ(Math.max(Math.abs(r[2]),Math.abs(a[2]))),s.normalized){const t=lt(Q[s.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn(\"THREE.GLTFLoader: Missing min/max properties for accessor POSITION.\")}}n.expandByVector(t)}t.boundingBox=n;const a=new THREE.Sphere;n.getCenter(a.center),a.radius=n.min.distanceTo(n.max)/2,t.boundingSphere=a}(t,e,i),Promise.all(n).then(function(){return void 0!==e.targets?function(t,e,i){let s=!1,n=!1,r=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(s=!0),void 0!==i.NORMAL&&(n=!0),void 0!==i.COLOR_0&&(r=!0),s&&n&&r)break}if(!s&&!n&&!r)return Promise.resolve(t);const a=[],o=[],h=[];for(let l=0,c=e.length;l<c;l++){const c=e[l];if(s){const e=void 0!==c.POSITION?i.getDependency(\"accessor\",c.POSITION):t.attributes.position;a.push(e)}if(n){const e=void 0!==c.NORMAL?i.getDependency(\"accessor\",c.NORMAL):t.attributes.normal;o.push(e)}if(r){const e=void 0!==c.COLOR_0?i.getDependency(\"accessor\",c.COLOR_0):t.attributes.color;h.push(e)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(h)]).then(function(e){const i=e[0],a=e[1],o=e[2];return s&&(t.morphAttributes.position=i),n&&(t.morphAttributes.normal=a),r&&(t.morphAttributes.color=o),t.morphTargetsRelative=!0,t})}(t,e.targets,i):t})}class pt{constructor(t,e){this.type=\"Door\";var i=this;this.par=t,this.fun=e,this.id=null,this.metods=new ft(this),this.content3d=new THREE.Object3D,this.par.content3d.add(this.content3d),this.array=[],this.down=function(t){let e=i.getGroup(t.target);e&&(i.fun(\"downGroup\",e),i.fun(\"openArray\",e.array))},this.over=function(t){let e=i.getGroup(t.target);e&&i.fun(\"overGroup\",e)},this.out=function(t){},this.getGroup=function(t){if(!t)return null;for(let s in i.objC3d)for(var e=0;e<i.objC3d[s].array.length;e++)if(i.objC3d[s].array[e].uuid==t.uuid)return i.objC3d[s];return t.parent?this.getGroup(t.parent):null},this.init=function(){this.loader=new T,visi3D.addEvent(\"down\",this.down),visi3D.addEvent(\"over\",this.over),visi3D.addEvent(\"out\",this.out)},this.openId=function(t){this.id=t;var e=\"resources/model/\"+t+\"/model.gltf\";this.loader.load(e,function(t){i.openC3d(t.scene)})},this.objC3d={},this.clear=function(){null!=this.c3d&&(visi3D.removeChildMouse(this.c3d),this.c3d.parent.remove(this.c3d)),this.objC3d={}},this.c3d=void 0,this.openC3d=function(t){this.clear(),this.c3d=t,this.parsingGeom(t),setTimeout(function(){for(var t in i.objC3d)i.objC3d[t].title=\"Всякая красивая хрень от сервака, в плане бла бла \"+Math.round(100*Math.random()),i.objC3d[t].name=i.objC3d[t].key+\"=\"+Math.round(100*Math.random()),i.objC3d[t].icon=\"not.png\";i.startC3d()},100)},this.startC3d=function(){visi3D.addChildMouse(this.c3d),this.content3d.add(this.c3d),this.metods.upRect(),i.fun(\"upServerModel\",i.objC3d),visi3D.intRend=1},this.parsingGeom=function(t){if(t.name){let e=t.name.split(\"_\");e.length>=2&&(null==this.objC3d[e[0]]&&(this.objC3d[e[0]]={key:e[0],array:[],name:\"\",title:\"\"}),this.objC3d[e[0]].array.push(t))}for(var e=0;e<t.children.length;e++)this.parsingGeom(t.children[e])},this.init()}}class ft{constructor(t){this.type=\"Metods\";this.par=t,this.upRect=function(){visi3D.utility.focus.targetObject=this.par.content3d,visi3D.render(),visi3D.utility.focus.targetObject=null}}}class mt{constructor(t){this.type=\"Glaf\";var e,i,r=this;function a(t){var e=window.document.URL.toString();e.split(\"/\");if(e.indexOf(\"?\")>0){var i=e.split(\"?\")[1].split(\"&\"),s=new Array(i.length),n=new Array(i.length);i=e.split(\"?\")[1].split(\"&\"),s=new Array(i.length),n=new Array(i.length);var r=0;for(r=0;r<i.length;r++){var a=i[r].split(\"=\");s[r]=a[0],\"\"!=a[1]?n[r]=unescape(a[1]):n[r]=null}for(r=0;r<i.length;r++)if(s[r]==t)return n[r];return null}}this.par=t,window.glafBig=this,this.init=function(){this.contHTML=document.createElement(\"div\"),this.contHTML.style.position=\"fixed\",this.contHTML.style.top=\"0px\",this.contHTML.style.left=\"0px\",this._activeObject=null,document.body.appendChild(this.contHTML);var t=JSON.parse('{\"scene\":{\"ambient\":{\"works\":true,\"active\":true,\"color\":\"#ffffff\",\"intensity\":0.71},\"shadow\":{\"works\":true,\"active\":true,\"mapSize\":4096,\"color\":\"#ffffff\",\"bias\":0.001,\"intensity\":0.06,\"radius\":1,\"bAlphaForCoating\":false,\"fixation\":true,\"rotationX\":0.67,\"rotationZ\":1.89,\"distance\":144.99,\"cubWidth\":1000,\"cubHeight\":1000,\"distanceUpdateShadow\":6.26},\"sky\":{\"works\":true,\"active\":false,\"color\":\"#ee295c\",\"link\":\"null\",\"radius\":522},\"mirror\":{\"works\":true,\"xz\":\"reflect\",\"link\":\"date/scenes3d/2/18-maps.jpg\",\"exposure\":8.33,\"gamma\":9.39,\"link1\":\"null\",\"exposure1\":-1,\"gamma1\":-1},\"visi3D\":{\"works\":true,\"alwaysRender\":false,\"fov\":45,\"far\":45000,\"minZum\":0,\"maxZum\":20000,\"zume\":763,\"powerZum\":19,\"minRotationX\":1.5,\"maxRotationX\":0,\"debug\":false,\"isDragPan\":true,\"alphaAd\":true,\"rotationX\":1,\"rotationZ\":-0.91,\"globZ\":0},\"effect\":{\"works\":true,\"active\":false,\"edgeStrength\":3,\"edgeGlow\":0.96,\"pulsePeriod\":4.11,\"linkTextur\":\"null\",\"visibleEdgeColor\":\"#ff5062\",\"hiddenEdgeColor\":\"#190a05\",\"edgeThickness\":5},\"fog\":{\"works\":true,\"active\":false,\"color\":\"#00ae9c\",\"near\":0,\"far\":2246}},\"three\":{\"uuid\":\"136621be-1b7c9d69\",\"key\":null,\"id\":null,\"name\":\"name37\",\"tId\":0,\"b\":[0,0,0],\"n\":[0,0,0],\"s\":[0,0,0],\"array\":[]}}');this.oSp=t;t.scene.visi3D.alphaAd;this.visi3D=new s.a(this.contHTML,null,!1,!0,!0,!0,!1),this.visi3D.yes3d=!0,this.content3d=new THREE.Object3D,this.visi3D.groupObject.add(this.content3d),this.content3d.rotation.x=-Math.PI/2,window.visi3D=this.visi3D,visi3D.position3d.boolMouseRight=!1,this.sceneSB=new n(this.visi3D);for(var e=0;e<this.sceneSB.array.length;e++)void 0===t.scene[this.sceneSB.array[e].name]&&(t.scene[this.sceneSB.array[e].name]={}),this.sceneSB.array[e].setBasa(t.scene[this.sceneSB.array[e].name]);visi3D.utility.debug=!1,visi3D.zume=5,this.menu=new E(this,function(t,e,i){\"openArray\"==t&&(visi3D.arrOut=e),\"openId\"==t&&r.door.openId(e)}),visi3D.renderer.setClearColor(this.menu.param.color,0),this.door=new pt(this,function(t,e,i){\"openArray\"==t&&(visi3D.arrOut=e),\"upServerModel\"==t&&r.menu.gLeft.addObj(e),\"downGroup\"==t&&r.menu.gLeft.downGroup(e),\"overGroup\"==t&&r.menu.gLeft.overGroup(e)})},this.init(),null!=a(\"id\")&&this.door.openId(a(\"id\")),this.update=function(){this.menu.update(),this.visi3D.upDate()},this.sizeWindow=function(t,s){t&&(e=t,i=s),this.visi3D.sizeWindow(0,0,e,i),this.menu.sizeWindow(e,i)}}}i.d(e,\"a\",function(){return gt});class gt{constructor(t){this.type=\"Main\";var e=this;this.init=function(){this.glaf=new mt(this),this.tick(),t(\"init\")},this.tick=function(){TWEEN.update(),e.glaf&&e.glaf.update(),requestAnimationFrame(e.tick)},this.ww=100,this.hh=100,this.sizeWindow=function(t,e){t&&(this.ww=t,this.hh=e),this.glaf&&this.glaf.sizeWindow(this.ww,this.hh)},this.init()}}},function(t,e,i){\"use strict\";function s(){var t=this,e=256,i=256,s=new THREE.Scene,n=new THREE.OrthographicCamera(e/-2,e/2,i/2,i/-2,.001,1e4),r=(new THREE.Clock,new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}));n.position.set(200,200,200),s.add(n),this.camera=n,this.fotoContainer=new THREE.Object3D,s.add(this.fotoContainer),s.background=new THREE.Color(38655),r.setPixelRatio(window.devicePixelRatio),r.setSize(e,i),r.localClippingEnabled=!0;var a=document.createElement(\"div\");a.style.position=\"absolute\",a.style.bottom=\"0px\",a.style.left=\"0px\",a.appendChild(r.domElement),this.contentHTML=a,this.canvas=r.domElement,this.contentHTML=a;var o=new THREE.AmbientLight(\"#ffffff\",1);s.add(o);var h=new THREE.GridHelper(1e3,10),l=new THREE.AxesHelper(100),c=new THREE.BoxHelper(this.fotoContainer,16776960);s.add(h),s.add(l),s.add(c);var u=[l,h,c];function d(){r.render(s,n)}this.render=d,d(),c.setFromObject(t.fotoContainer);var p=new THREE.Box3,f=new THREE.Vector3;this.box=p,this.center=f,this.setSize=function(t,s){e=t,i=s,r.setSize(e,i),n.aspect=e/i,n.updateProjectionMatrix()},this.addObjFoto=function(t){this.fotoContainer.add(t),c.setFromObject(this.fotoContainer)},this.removeObjFoto=function(t){this.fotoContainer.remove(t)},this.moveToObj=function(e){p.setFromObject(e||t.fotoContainer);var i=p.max.x-p.min.x,s=p.max.z-p.min.z;t.moveToRect(p.min.x,p.min.z,i,s)},this.moveToRect=function(t,e,i,s){if(t+=i/2,e+=s/2,f.set(t,0,e),n.position.set(f.x,9e3,f.z),n.lookAt(f),\"OrthographicCamera\"===n.type){var r=Math.max(s,i);n.zoom=1,n.left=r/-2,n.right=r/2,n.top=r/2,n.bottom=r/-2,n.aspect=r/r}n.updateProjectionMatrix()},this.getFoto=function(t){t=t||1024;for(var n=0;n<u.length;n++)u[n].visible=!1;var a=s.background;s.background=null,r.setSize(t,t),d();var o=r.domElement.toDataURL(\"image/png\");r.setSize(e,i),s.background=a;for(var h=0;h<u.length;h++)u[h].visible=!0;return d(),o},this.getCanvas=function(t){t=t||1024;for(var e=0;e<u.length;e++)u[e].visible=!1;s.background;s.background=null;var i=r.getSize();return i.width==t&&i.height==t||r.setSize(t,t),d(),r.domElement}}function n(t){var e=this,i=THREE.Math.generateUUID(),n=new THREE.Vector3(0,1,0),h=(new THREE.Plane(n,.01),new THREE.Vector4(0,999,0,.001)),l=new THREE.Box3,c=t||new s;this.foto3D=c;var u=new THREE.Vector2(0,0),d=100,p=new a;this.canvas=p.canvas,this.isTime=!1;var f=new THREE.Texture(p.canvas);this.texturePlan=f,this.matPlan=new THREE.MeshPhongMaterial({transparent:!0,side:THREE.DoubleSide,map:f});var m=new o;this.canvasGG=m,m.arrColorStopTranspanent[0]=.15,m.arrProcent[0]=.82,m.arrColorStopTranspanent[1]=1,m.arrProcent[1]=1,m.update();var g=new THREE.Texture(m.canvas);g.needsUpdate=!0,this.textureShadow=g,this.content3d=new THREE.Object3D,this.shadowContent3d=new THREE.Object3D,this.meshPlan=new THREE.Mesh(new THREE.PlaneGeometry(1,1),this.matPlan),this.meshPlan.rotation.x=-Math.PI/2,this.content3d.add(this.meshPlan);var v=new THREE.Mesh(new THREE.SphereGeometry(10,16,16));v.position.set(h.x,h.y,h.z),this.arrShadowMesh=[],this.arrObj=[],this._dunamic=!0,this.dirty=!0,this._lightPosition4D=h,this._fotoPosition=new THREE.Vector2(0,0),this._fotoWH=150,this._imgWH=512,this._imgBlur=1,this._imgAlpha=1,this._offsetY=0,this._scaleShadow=1,this._isDinamFotoRect=!1,this._opacityMat=1;var E=[new THREE.Plane(new THREE.Vector3(0,-1,0),100),new THREE.Plane(new THREE.Vector3(0,1,0),0)];this._shadowMaterial=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,opacity:this._opacityMat,depthWrite:!1,map:g,clippingPlanes:E,clipIntersection:!1}),this.arrDataSempl=[],this.arrDataSempl.push(new r(0,200,3,1));var x=new THREE.Group;this.content3d.add(x);var T=new THREE.Mesh(new THREE.PlaneGeometry(1,1),new THREE.MeshBasicMaterial({side:THREE.DoubleSide,map:g,transparent:!0}));T.scale.set(1,30,1),T.rotation.z=-Math.PI/2,x.add(T),x.visible=!1,this.helpers=x,this.setConstMax=function(t){E[0].constant=t},this.setConstMin=function(t){E[1].constant=-t},this.addObj=function(t){if(-1==e.arrObj.indexOf(t)){t.updateMatrixWorld();var i=t.clone();!function t(e,i){e.userData.targetObject=i;for(var s=0;s<e.children.length;s++){if(!i.children[s])throw new Error(\"обекты не одинаковы\");t(e.children[s],i.children[s])}}(i,t),function(t){var i=[];!function t(e,i){\"Mesh\"==e.type&&i.push(e);for(var s=0;s<e.children.length;s++)\"Mesh\"==e.type?i.push(e.children[s]):t(e.children[s],i)}(t,i);for(var s=0;s<i.length;s++)i[s].material=e._shadowMaterial}(i),e.arrShadowMesh.push(i),e.arrObj.push(t),e.shadowContent3d.add(i),this.dirty=!0}},this.removeObj=function(t){var i=e.arrObj.indexOf(t);-1!=i&&(e.arrObj.splice(i,1),e.shadowContent3d.remove(e.arrShadowMesh[i]),e.arrShadowMesh.splice(i,1),this.dirty=!0)},this.clear=function(){for(var t=0;(t=e.arrObj.length)>0;)if(e.removeObj(e.arrObj[t-1]),t===e.arrObj.length)throw new Error(\"object not remove\")},this.intRend=1,this.intRendOk=1,this.upDate=function(){e.opacityMat&&(e.dunamic&&(e.intRend=e.intRendOk),e.intRend==e.intRendOk&&(e.dirty||function(){for(var t=0;t<e.arrShadowMesh.length;t++)if((e._isDinamFotoRect||_(e.arrShadowMesh[t]))&&b(e.arrShadowMesh[t]))return!0;return!1}())&&e.render(),e.intRend++)};function _(t){var i=!1,s=!1,n=l.min.x,r=l.min.z,a=l.max.x-l.min.x,o=l.max.z-l.min.z;if(l.setFromObject(t.userData.targetObject),i=H(n=l.min.x,r=l.min.z,a=l.max.x-l.min.x,o=l.max.z-l.min.z,e.fotoPosition.x,e.fotoPosition.y,e.fotoWH,e.fotoWH),l.setFromObject(t),s=H(n=l.min.x,r=l.min.z,a=l.max.x-l.min.x,o=l.max.z-l.min.z,e.fotoPosition.x,e.fotoPosition.y,e.fotoWH,e.fotoWH),!i&&!s)return!1;i=!1,s=!1;for(var h=0;h<t.children.length;h++)if(l.setFromObject(t.children[h].userData.targetObject),n=l.min.x,r=l.min.z,a=l.max.x-l.min.x,o=l.max.z-l.min.z,i=i||H(n,r,a,o,e.fotoPosition.x,e.fotoPosition.y,e.fotoWH,e.fotoWH),l.setFromObject(t.children[h]),n=l.min.x,r=l.min.z,a=l.max.x-l.min.x,o=l.max.z-l.min.z,s=s||H(n,r,a,o,e.fotoPosition.x,e.fotoPosition.y,e.fotoWH,e.fotoWH),i||s)return!0;return!0}function b(t){if(!function(t,e){if(t.position.equals(e.position)&&t.quaternion.equals(e.quaternion)&&t.scale.equals(e.scale)&&t.visible===e.visible)return!0;return!1}(t,t.userData.targetObject))return!0;for(var e=0;e<t.children.length;e++)if(b(t.children[e]))return!0;return!1}function y(t){!function(t,e){t.position.copy(e.position),t.quaternion.copy(e.quaternion),t.scale.copy(e.scale),t.visible=e.visible}(t,t.userData.targetObject);for(var e=0;e<t.children.length;e++)y(t.children[e])}this.render=function(){e.isTime&&console.time(\"render \"+i),e.dirty=!1,function(){h.w=.001,v.position.set(h.x,h.y,h.z);for(var t=0;t<e.arrShadowMesh.length;t++)y(e.arrShadowMesh[t]);A()}(),c.addObjFoto(e.shadowContent3d),d=e.fotoWH,u.x=e.fotoPosition.x,u.y=e.fotoPosition.y,e.isDinamFotoRect&&(l.setFromObject(e.shadowContent3d),u.x=l.min.x,u.y=l.min.z,d=Math.max(l.max.x-l.min.x,l.max.z-l.min.z),u.x-=100,u.y-=100,d+=200),c.moveToRect(u.x,u.y,d,d),function(){var t=c.getCanvas(e.imgWH);p.setCanvas(t),0==e.arrDataSempl.length&&p.update();for(var i=0;i<e.arrDataSempl.length;i++)e.setConstMin(e.arrDataSempl[i].min*e._scaleShadow+e._offsetY),e.setConstMax(e.arrDataSempl[i].max*e._scaleShadow+e._offsetY),c.render(),p._blur=e.arrDataSempl[i].blur+(e._scaleShadow>1?e._scaleShadow:0),p._alpha=e.arrDataSempl[i].alpha,p.update();e.setConstMin(-999999),e.setConstMax(999999),f.needsUpdate=!0}(),e.meshPlan.scale.set(d,d,1),e.meshPlan.position.set(u.x+d/2,0,u.y+d/2),e.isTime&&console.timeEnd(\"render \"+i),e.onUpdate&&e.onUpdate()};var w=new THREE.Box3(new THREE.Vector3,new THREE.Vector3(300,300,300));this.boundingBoxUv=w;var R=new THREE.Vector3;function S(t){if(\"Mesh\"===t.type){var i=!1,s=t.getWorldPosition(t.position),n=t.getWorldQuaternion(t.quaternion),r=e.maxHeight;s.y-=e._offsetY,t.userData.pos?t.userData.pos.y!=s.y?i=!0:t.userData.rot.equals(n)?t.userData.maxHeight!==r?i=!0:t.userData.scaleShadow!==e._scaleShadow&&(i=!0):i=!0:i=!0,e._isDinamFotoRect||(l.setFromObject(t),H(l.min.x,l.min.z,l.max.x-l.min.x,l.max.z-l.min.z,e.fotoPosition.x,e.fotoPosition.y,e.fotoWH,e.fotoWH)||(i=!1)),i&&(!function(t){t.geometry.uuid===t.userData.targetObject.geometry.uuid&&(t.geometry=t.userData.targetObject.geometry.clone());var i=w,s=0;if(t.geometry instanceof THREE.Geometry){for(var n=t.geometry.faces,r=t.geometry.vertices,a=t.geometry.faceVertexUvs[0],o=0;o<n.length;o++)R.set(r[n[o].a].x,r[n[o].a].y,r[n[o].a].z),t.localToWorld(R),s=1-D(R.y-e._offsetY,i.min.y,i.min.y+i.max.y)/100,a[o][0].set(s,s),R.set(r[n[o].b].x,r[n[o].b].y,r[n[o].b].z),t.localToWorld(R),s=1-D(R.y-e._offsetY,i.min.y,i.min.y+i.max.y)/100,a[o][1].set(s,s),R.set(r[n[o].c].x,r[n[o].c].y,r[n[o].c].z),t.localToWorld(R),s=1-D(R.y-e._offsetY,i.min.y,i.min.y+i.max.y)/100,a[o][2].set(s,s);t.geometry.uvsNeedUpdate=!0}else{var h=t.geometry.attributes.position.array;t.geometry.attributes.uv||(arrUvAttribut=new Float32Array(h.length/3*2),t.geometry.addAttribute(\"uv\",new THREE.BufferAttribute(arrUvAttribut,2)));var l=t.geometry.attributes.uv.array,c=(t.geometry.attributes.uv.itemSize,t.geometry.index.array),u=t.geometry.index.count;for(o=0;o<u;o++){var d=c[o],p=3*d,f=2*d;R.set(h[p],h[p+1],h[p+2]),t.localToWorld(R),s=1-D(R.y-e._offsetY,i.min.y,i.min.y+i.max.y*e._scaleShadow)/100,l[f]=s,l[f+1]=s}t.geometry.attributes.uv.needsUpdate=!0}}(t),t.userData.pos=s,t.userData.rot=n,t.userData.maxHeight=r,t.userData.scaleShadow=e._scaleShadow)}for(var a=0;a<t.children.length;a++)S(t.children[a])}function A(){T.scale.x=(e.boundingBoxUv.max.y||1)*e._scaleShadow,T.position.y=T.scale.x/2+e.boundingBoxUv.min.y;for(var t=0;t<e.arrShadowMesh.length;t++)(e._isDinamFotoRect||(l.setFromObject(e.arrShadowMesh[t]),H(l.min.x,l.min.z,l.max.x-l.min.x,l.max.z-l.min.z,e.fotoPosition.x,e.fotoPosition.y,e.fotoWH,e.fotoWH)))&&S(e.arrShadowMesh[t])}this.updateShadowUv=A,this.updateShadowTexture=function(){this.canvasGG.update(),this.textureShadow.needsUpdate=!0},this.setShadowColor=function(t,i,s){m.r=t,m.g=i,m.b=s,e.updateShadowTexture()},this.getConfig=function(){var t={};return t.imgWH=e.imgWH,t.fotoPosition={x:e._fotoPosition.x,y:e._fotoPosition.y},t.fotoWH=e.fotoWH,t.maxHeight=e.maxHeight,t.isDinamFotoRect=e.isDinamFotoRect,t.arrDataSempl=e.arrDataSempl,t.opacityMat=e.opacityMat,t.dunamic=e.dunamic,t.canvasGG={arrColorStopTranspanent:e.canvasGG.arrColorStopTranspanent,arrProcent:e.canvasGG.arrProcent},t},this.setConfig=function(t){e.canvasGG.arrColorStopTranspanent=t.canvasGG.arrColorStopTranspanent,e.canvasGG.arrProcent=t.canvasGG.arrProcent,e.fotoPosition.x=t.fotoPosition.x,e.fotoPosition.y=t.fotoPosition.y,e.fotoWH=t.fotoWH,e.isDinamFotoRect=t.isDinamFotoRect,e.arrDataSempl=t.arrDataSempl,e.opacityMat=t.opacityMat,e.imgWH=t.imgWH,e.dunamic=t.dunamic,e.updateShadowTexture(),e.maxHeight=t.maxHeight};var M={imgWH:1024,fotoPosition:{x:0,y:0},fotoWH:150,maxHeight:300,isDinamFotoRect:!1,arrDataSempl:[{min:0,max:6,blur:.8,alpha:.25},{min:4,max:15,blur:3,alpha:.64},{min:10,max:23,blur:4,alpha:.5},{min:15,max:50,blur:15,alpha:1},{min:20,max:198.09,blur:15,alpha:.7},{min:0,max:2,blur:1.02,alpha:1}],opacityMat:1,dunamic:!0,canvasGG:{arrColorStopTranspanent:[0,1,.25],arrProcent:[.4,1,.96]}};function H(t,e,i,s,n,r,a,o){return t<n+a&&e<r+o&&t+i>n&&e+s>r}function D(t,e,i,s){return e=null!=e?e:0,i=null!=i?i:100,s=s||100,isNaN(parseFloat(t))&&(t=e),t<e&&(t=e),t>i&&(t=i),t=Math.round(t*s)/s,e<0?100*(Math.abs(e)+t)/(Math.abs(e)+Math.abs(i)||1):100*(Math.abs(e)-t)/(Math.abs(e)-Math.abs(i)||1)}this.sss=M,this.setConfig(M),this.getBase64=function(){return e.render(),p.canvas.toDataURL()},this.debug=!1}function r(t,e,i,s){this.min=t||0,this.max=e||1,this.blur=i||0,this.alpha=s||1}function a(){var t=this,e=document.createElement(\"canvas\");this.canvas=e,e.width=256,e.height=256;var i=e.getContext(\"2d\"),s=new Image;this.b64=null,this._blur=0,this._blur1=1,this._alpha=1,this.image=new Image,this.setBase64=function(i,n){this.b64=i,(s=new Image).onload=function(){e.clearRect(0,0,e.width,e.height),e.width=s.width,e.height=s.height,t.update(),n&&n(e.toDataURL())},s.src=i},this.setCanvas=function(t){s=t,e.width=t.width,e.height=t.height},this.update=function(){i.filter=\"blur(\"+t._blur+\"px)\",i.globalAlpha=t._alpha,i.drawImage(s,0,0)}}function o(){var t=this,e=document.createElement(\"canvas\");e.width=e.height=256,this.canvas=e;var i=e.getContext(\"2d\");this._blur=0,this._alpha=1,this.arrColorStopTranspanent=[0,1],this.arrProcent=[0,1],this.position=new THREE.Vector2,this.position1=new THREE.Vector2(1,0),this.r=0,this.g=0,this.b=0,this.update=function(){var s=e.width,n=e.height;i.clearRect(0,0,s,n),i.rect(0,0,s,n),i.filter=\"blur(\"+t._blur+\"px)\",i.globalAlpha=t._alpha;for(var r=t.position.x*s,a=t.position.y*n,o=t.position1.x*s,h=t.position1.y*n,l=i.createLinearGradient(r,a,o,h),c=0;c<t.arrColorStopTranspanent.length;c++)l.addColorStop(t.arrProcent[c],\"rgba(\"+t.r+\",\"+t.g+\",\"+t.b+\",\"+t.arrColorStopTranspanent[c]+\")\");i.fillStyle=l,i.fill()},this.update()}function h(t){this.parent=t;this._active=!1,this._visible=!0,this.WH=512,this._wn=this.WH,this._obj3d=void 0,this.smc=void 0,this.init=function(){null==this.smc&&(this.smc=new n,this.smc.fotoPosition.set(-this._wn/2,-this._wn/2),this.smc.fotoWH=this._wn,this.smc.content3d.rotation.x=-Math.PI/2,this.smc.content3d.position.y=-1,this.smc.content3d.visible=this._visible,this.dergObj())},this.dergActiv=function(){1==this._active?null==this.smc.content3d.parent&&this.parent.parent.groupObject.add(this.smc.content3d):null!=this.smc.content3d.parent&&this.parent.parent.groupObject.remove(this.smc.content3d)},this.render=function(){null!=this.smc&&null!=this.smc.content3d.parent&&this.smc.upDate()},this.dergObj=function(){null!=this.smc&&(null!=this._obj3d?this.smc.arrObj[0]==this._obj3d||(this.smc.clear(),this.smc.addObj(this._obj3d)):this.smc.clear())}}Object.defineProperties(n.prototype,{scaleShadow:{set:function(t){this.dirty=!0,this._scaleShadow=t},get:function(){return this._scaleShadow}},debug:{set:function(t){this.helpers.visible=t},get:function(){return this.helpers.visible}},offsetY:{set:function(t){this._offsetY=t,this.dirty=!0},get:function(){return this._offsetY}},maxHeight:{set:function(t){this.dirty=!0,this.boundingBoxUv.max.y=t,this.updateShadowUv()},get:function(){return this.boundingBoxUv.max.y}},dunamic:{set:function(t){this.dirty=!0,this._dunamic=t},get:function(){return this._dunamic}},fotoPosition:{set:function(t){this.dirty=!0,this._fotoPosition=t},get:function(){return this._fotoPosition}},fotoWH:{set:function(t){this.dirty=!0,this._fotoWH=t},get:function(){return this._fotoWH}},imgWH:{set:function(t){this.dirty=!0,this._imgWH=t},get:function(){return this._imgWH}},imgBlur:{set:function(t){this.dirty=!0,this._imgBlur=t},get:function(){return this.dirty=!0,this._imgBlur}},imgAlpha:{set:function(t){this.dirty=!0,this._imgAlpha=t},get:function(){return this._imgAlpha}},isDinamFotoRect:{set:function(t){this.dirty=!0,this._isDinamFotoRect=t},get:function(){return this._isDinamFotoRect}},opacityMat:{set:function(t){this.dirty=!0,this._opacityMat=t,this.matPlan.opacity=this._opacityMat},get:function(){return this._opacityMat}},shadowMaterial:{set:function(t){if(t!==this._shadowMaterial){this._shadowMaterial=t;for(var e=0;e<this.arrShadowMesh.length;e++)if(this.arrShadowMesh[e]instanceof THREE.ShadowMesh)this.arrShadowMesh[e].material=this._shadowMaterial;else for(var i=0;i<this.arrShadowMesh[e].children.length;i++)this.arrShadowMesh[e].children[i]instanceof THREE.ShadowMesh&&(this.arrShadowMesh[e].children[i].material=this._shadowMaterial)}},get:function(){return this._shadowMaterial}},lightPosition4D:{set:function(t){this._lightPosition4D.set(t.x,t.y,t.z,.001)},get:function(){return this._lightPosition4D}}}),Object.defineProperties(a.prototype,{blur:{set:function(t){this._blur=t},get:function(){return this._blur}},alpha:{set:function(t){this._alpha=t},get:function(){return this._alpha}}}),Object.defineProperties(o.prototype,{}),i.d(e,\"a\",function(){return h}),h.prototype={set active(t){this._active!==t&&(this._active=t,this.init(),this.dergActiv())},get active(){return this._active},set visible(t){this._visible!==t&&(this._visible=t,null!=this.smc&&(this.smc.content3d.visible=t))},get visible(){return this._visible},set obj3d(t){this._obj3d!==t&&(this._obj3d=t,this.dergObj())},get obj3d(){return this._obj3d},set wh(t){this._wh!==t&&(this._wh=t,null!=this.smc&&(this.smc.fotoPosition.set(-this._wn/2,-this._wn/2),this.smc.fotoWH=this._wn))},get wh(){return this._wh}}},function(t,e,i){\"use strict\";var s=i(0),n=i(2);function r(t){var e=this;this.visi3D=t,this.box3=new THREE.Box3,this.rectScreen=new o,this.world=new o(0,0,1,1),this.targetObject=null,this.arrPoint=[],this.isMoveCam=!1,this.isFromGeometry=!1,this._offset=0,this._active=!0,this._debug=!1;var i=new THREE.Vector2,s=new THREE.Vector2,n=new THREE.Vector3;function r(){e.zumeVisi3D(),i.set(e.world.x+e.world.width/2,e.world.y+e.world.height/2),s.set(e.rectScreen.x+e.rectScreen.width/2,e.rectScreen.y+e.rectScreen.height/2),i.sub(s).divideScalar(2)}this.upDate=function(){if(e.active&&(this.updateBound3d(),!e.box3.isEmpty())){if(this.visi3D.xVerh=n.x,this.visi3D.zVerh=n.z,this.visi3D.yVerh=-n.y,e.zumeVisi3D(),e.isMoveCam){r();for(var t=0;i.length()>2&&++t<10;)this.visi3D.position3d.moveCamXY(i),r()}e.debugFocus&&e.debugFocus.upDate()}},this.zumeVisi3D=function(){for(var t,i,s=0,n=6e4,r=0;s<n&&!(++r>20)&&(i=t=(s+n)/2,e.visi3D.zume=i,!(Math.abs(s-t)<.01||Math.abs(n-t)<.01||t<.01));)e.updateRectScreen(),e.isZoomIn()?n=t:s=t+1},this.updateBound3d=function(){if(e.box3.makeEmpty(),e.targetObject)e.box3.copy(e.getCompoundBoundingBox(e.targetObject));else for(var t=0;t<e.arrPoint.length;t++)e.box3.expandByPoint(e.arrPoint[t]);e.box3.getCenter(n)},this.updateRectScreen=function(){if(this.visi3D.camera.updateMatrixWorld(),this.visi3D.scene.updateMatrixWorld(),e.targetObject&&e.isFromGeometry){var t=e.getBoxObject(e.targetObject);e.box3.copy(t.box3),e.box3.getCenter(n),e.setRectFromBox(e.rectScreen,t.box2)}else e.setRectFromBox(e.rectScreen,e.boxToScreen(e.box3));e.updateWorldSize()},this.setRectFromBox=function(t,e){t.x=e.min.x,t.y=e.min.y,t.width=e.max.x-e.min.x,t.height=e.max.y-e.min.y},this.getCompoundBoundingBox=function(){var t=new THREE.Box3,e=new THREE.Box3;function i(i){var s=i.geometry;void 0!==s&&(s.boundingBox||s.computeBoundingBox(),e.copy(s.boundingBox),e.applyMatrix4(i.matrixWorld),t.union(e))}return function(e){return e.updateMatrixWorld(!0),t.makeEmpty(),e.traverseVisible(i),t}}(),this.boxToScreen=function(){for(var t=new THREE.Box2,i=[],s=0;s<8;s++)i[s]=new THREE.Vector3;return function(s){t.makeEmpty(),i[0].set(s.min.x,s.min.y,s.min.z),i[1].set(s.min.x,s.max.y,s.min.z),i[2].set(s.max.x,s.min.y,s.min.z),i[3].set(s.max.x,s.max.y,s.min.z),i[4].set(s.min.x,s.min.y,s.max.z),i[5].set(s.min.x,s.max.y,s.max.z),i[6].set(s.max.x,s.min.y,s.max.z),i[7].set(s.max.x,s.max.y,s.max.z);for(var n=0;n<i.length;n++)t.expandByPoint(e.toScreenXY(i[n]));return t}}(),this.getBoxObject=function(){var t,i,s=new THREE.Box2,n=new THREE.Box3,r={box2:s,box3:n},a=new THREE.Vector3;function o(r){var o=r.geometry;if(void 0!==o)if(o.isGeometry){var h=o.vertices;for(t=0,i=h.length;t<i;t++)a.copy(h[t]).applyMatrix4(r.matrixWorld),n.expandByPoint(a),s.expandByPoint(e.toScreenXY(a))}else if(o.isBufferGeometry){var l=o.attributes.position;if(void 0!==l)for(t=0,i=l.count;t<i;t++)a.fromBufferAttribute(l,t).applyMatrix4(r.matrixWorld),n.expandByPoint(a),s.expandByPoint(e.toScreenXY(a))}}return function(t){return t.updateMatrixWorld(!0),s.makeEmpty(),n.makeEmpty(),t.traverseVisible(o),r}}();var a=new THREE.Vector2,h=new THREE.Vector3;this.toScreenXY=function(t){return h.copy(t),h.project(e.visi3D.camera),a.x=Math.round((h.x+1)*e.visi3D._width/2*1e3)/1e3,a.y=Math.round((1-h.y)*e.visi3D._height/2*1e3)/1e3,a},this.updateWorldSize=function(){e.world.x=e.offset,e.world.y=e.offset,e.world.width=this.visi3D._width-2*e.offset,e.world.height=this.visi3D._height-2*e.offset},this.isZoomIn=function(){return e.rectScreen.x>e.world.x&&e.rectScreen.x+e.rectScreen.width<e.world.x+e.world.width&&e.rectScreen.y>e.world.y&&e.rectScreen.y+e.rectScreen.height<e.world.y+e.world.height}}function a(t){var e=this;this.mFocus=t;var i=visi3D.scene,s=main.stage,n=new BoxHelper(1,materialAlphaRed);i.add(n);var r=new PIXI.Graphics;r.hitArea=new PIXI.Rectangle(0,0,0,0),s.addChild(r),e.active=!1,n.visible=r.visible=e.active,this.upDate=function(){n.visible=r.visible=e.active,e.active&&(r.clear(),r.position.set(visi3D._x,visi3D._y),r.lineStyle(1,0,1),r.drawRect(t.world.x,t.world.y,t.world.width,t.world.height),r.lineStyle(1,16711680,1),r.drawRect(t.rectScreen.x,t.rectScreen.y,t.rectScreen.width,t.rectScreen.height),n.width=t.box3.max.x-t.box3.min.x,n.depth=t.box3.max.y-t.box3.min.y,n.height=t.box3.max.z-t.box3.min.z,t.box3.getCenter(n.position))}}function o(t,e,i,s,n){this._x=t||0,this._y=e||0,this._width=void 0!==i?i:100,this._height=void 0!==s?s:100,this.angel=0,this.p=new h,this.fun,this.set=function(t,e,i,s){this._x=t||0,this._y=e||0,this._width=void 0!==i?i:100,this._height=void 0!==s?s:100},this.setRect=function(t){this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this.p.setPoint(t.p),this.angel=t.angel}}function h(t,e,i){this._x=t||0,this._y=e||0,this._z=i||0,this.xx=0,this.yy=0,this.zz=0,this.set=function(t,e,i){this._x=t||0,this._y=e||0,void 0!==i&&(this._z=i)},this.setPoint=function(t){this._x=t.x,this._y=t.y,void 0!==t.z&&(this._z=t.z)},this.getObj=function(){var t={};return t.x=this._x,t.y=this._y,t.z=this._z,t},this.copy=function(){return new h(this._x,this._y,this._z)}}function l(t){var e=this;this.parent=t,this._debug=!1,this.debugInit=!1,this.shadowHelper=void 0,this.spotLightHelper=void 0,this.gridHelper=void 0,this.FIXATION=!1,this.ROTATION_X=0,this.ROTATION_Z=0,this.DISTANCE=this.parent.DISTANCE,this.CUB_HEIGHT=this.parent.CUB_HEIGHT,this.CUB_WIDTH=this.parent.CUB_WIDTH,this.SKY_X=0,this.SKY_Y=0,this.SKY_Z=0,this._fixation=this.FIXATION,this._rotationX=this.ROTATION_X,this._rotationZ=this.ROTATION_Z,this._distance=this.DISTANCE,this._cubHeight=this.CUB_HEIGHT,this._cubWidth=this.CUB_WIDTH,this.sky=new s.a(this),this.smc=new n.a(this),this.focus=new r(this.parent),this.funDebug=function(){1!=this.debugInit&&(this.debugInit=!0,this.plane=new THREE.Mesh(new THREE.PlaneGeometry(1e3,1e3).rotateX(-Math.PI),new THREE.MeshPhongMaterial({color:11316396,transparent:!0,opacity:.5})),this.plane.castShadow=this.plane.receiveShadow=!0,this.plane.position.z=2,this.plane.renderOrder=1,this.gridHelper=new THREE.GridHelper(10,10),this.gridHelper.rotation.x=-Math.PI/2,this.shadowHelper=new THREE.CameraHelper(this.parent.sunLight.shadow.camera),this.parent.sunLight&&(this.spotLightHelper=new THREE.DirectionalLightHelper(this.parent.sunLight))),1==this._debug?(null==this.gridHelper.parent&&this.parent.groupObject.add(this.gridHelper),null==this.plane.parent&&this.parent.groupObject.add(this.plane),null==this.shadowHelper.parent&&this.parent.scene.add(this.shadowHelper),this.parent.sunLight&&(null!=this.parent.sunLight.parent||(null!=this.spotLightHelper.parent&&this.parent.scene.remove(this.spotLightHelper),null!=this.shadowHelper.parent&&this.parent.scene.remove(this.shadowHelper)))):(null!=this.gridHelper.parent&&this.parent.groupObject.remove(this.gridHelper),null!=this.plane.parent&&this.parent.groupObject.remove(this.plane),null!=this.shadowHelper.parent&&this.parent.scene.remove(this.shadowHelper),this.parent.sunLight&&null!=this.spotLightHelper.parent&&this.parent.scene.remove(this.spotLightHelper))},this.render=function(){1==this._debug&&null!=this.spotLightHelper&&this.spotLightHelper.update(),this.smc.render(),this.sky.render(),this.focus.upDate(),this.dragSunLight()};var i=0;this.dragSunLight=function(){var t;null!=this.parent.sunLight&&(null!=this.parent.sunLight.parent&&(!0===e._fixation?(i=this._distance+2*this._cubHeight,e.parent.sunLight.position.set(0,i,0),e.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1,0,0),e._rotationX),e.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0,1,0),e._rotationZ-e.parent._rotationZ)):(i=this._distance+this._cubHeight,this.parent.sunLight.position.set(0,i,0),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1,0,0),this._rotationX),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0,1,0),this._rotationZ),this.parent.staticShadow&&(t=new THREE.Vector3(e.parent.xVerh,e.parent.yVerh,e.parent.zVerh),e.parent.sunLight.position.add(t),e.parent.sunLight.target.position.copy(t),f.distanceTo(t)>e.distanceUpdateShadow&&(f.copy(t),e.parent.shadowNeedsUpdate=!0)))))};var a,o,h,l,c,u,d,p,f=new THREE.Vector3;this.distanceUpdateShadow=500,this.dragSunLight2=function(){null!=this.parent.sunLight&&null!=this.parent.sunLight.parent&&(!0===this._fixation||(i=this._distance+2*this._cubHeight,this.parent.sunLight.position.set(0,i,0),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(1,0,0),this._rotationX),this.parent.sunLight.position.applyAxisAngle(new THREE.Vector3(0,1,0),this._rotationZ)))},this.dragSunLight3=function(){this.parent.sunLight&&(this.parent.sunLight.shadow.camera.near=0+this._cubHeight,this.parent.sunLight.shadow.camera.far=2*this._cubHeight+this._cubHeight,this.parent.sunLight.shadow.camera.updateProjectionMatrix(),this.shadowHelper&&this.shadowHelper.update())},this.sunActiv=function(t){this.parent.objShadow(this.parent.group,t),1==t?null==this.parent.sunLight.parent&&(this.parent.scene.add(this.parent.sunLight),this.parent.scene.add(e.parent.sunLight.target)):null!=this.parent.sunLight.parent&&(this.parent.scene.remove(this.parent.sunLight),this.parent.scene.remove(e.parent.sunLight.target)),this.funDebug()},this.ambientActiv=function(t){1==t?null==this.parent.ambientLight.parent&&this.parent.scene.add(this.parent.ambientLight):null!=this.parent.ambientLight.parent&&this.parent.scene.remove(this.parent.ambientLight)};var m={x:0,y:0};this.korektZ=function(t){return a=this.parent._rotationZ%(2*Math.PI),h=a+2*Math.PI*2,l=a+2*Math.PI*1,o=t%(2*Math.PI),c=o+2*Math.PI*2,u=Math.abs(c-h),d=Math.abs(c-l),p=c,u>d&&(p=c+2*Math.PI),m.x=h,m.y=p,m}}r.prototype={set offset(t){this._offset=t||0},get offset(){return this._offset},set debug(t){this._debug=t,t&&!this.debugFocus&&(this.debugFocus=new a(this)),this.debugFocus&&(this.debugFocus.active=t)},get debug(){return this._debug},set active(t){this._active=t,t||(this.debug=!1)},get active(){return this._active}},o.prototype={set x(t){this._x!==t&&(this._x=t)},get x(){return this._x},set y(t){this._y!==t&&(this._y=t)},get y(){return this._y},set width(t){this._width!==t&&(this._width=t)},get width(){return this._width},set height(t){this._height!==t&&(this._height=t)},get height(){return this._height}},h.prototype={set x(t){this._x=t},get x(){return this._x},set y(t){this._y=t},get y(){return this._y},set z(t){this._z=t},get z(){return this._z}},i.d(e,\"a\",function(){return l}),l.prototype={set debug(t){this._debug!==t&&(this._debug=t,this.funDebug())},get debug(){return this._debug},set rotationX(t){this._rotationX!==t&&(this._rotationX=t,null!=this.spotLightHelper&&(this.parent.sunLight.shadow.camera.updateProjectionMatrix(),this.spotLightHelper.update()),this.dragSunLight2())},get rotationX(){return this._rotationX},set rotationZ(t){this._rotationZ!==t&&(this._rotationZ=t,this.sky.shadRotZ=t,null!=this.spotLightHelper&&this.spotLightHelper.update(),this.dragSunLight2())},get rotationZ(){return this._rotationZ},set fixation(t){this._fixation!==t&&(this._fixation=t,this.dragSunLight2())},get fixation(){return this._fixation},set distance(t){this._distance!==t&&(this._distance=t,this.dragSunLight3(),this.dragSunLight2())},get distance(){return this._distance},set cubHeight(t){this._cubHeight!==t&&(this._cubHeight=t,this.dragSunLight3(),this.dragSunLight2())},get cubHeight(){return this._cubHeight},set cubWidth(t){this._cubWidth!==t&&(this._cubWidth=t,this.parent.sunLight&&(this.parent.sunLight.shadow.camera.right=this._cubWidth,this.parent.sunLight.shadow.camera.left=-this._cubWidth,this.parent.sunLight.shadow.camera.top=this._cubWidth,this.parent.sunLight.shadow.camera.bottom=-this._cubWidth,this.parent.sunLight.shadow.camera.updateProjectionMatrix(),this.shadowHelper&&this.shadowHelper.update()))},get cubWidth(){return this._cubWidth}}},function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",function(){return MVisi3D});var _MPosition3d_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5),_MEvent3DArr_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),_MUtility_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_efect_Efect_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6);function MVisi3D(_contentHTML,_content2d,_devas,_directional,_efect,_event3DArr,_alpha){var self=this;this.contentHTML=_contentHTML,_devas=void 0!==_devas&&_devas,_directional=void 0===_directional||_directional,_efect=void 0===_efect||_efect,_event3DArr=void 0===_event3DArr||_event3DArr,_alpha=void 0!==_alpha&&_alpha,this.intRend=0,this.devas=_devas,this.alpha=_alpha,this.arrSetiScene=[],this._xVerh=0,this._yVerh=0,this._zVerh=0,this._rotationX=0,this._rotationZ=0,this._zume=1e3,this._arrOut=[],this._x=0,this._y=0,this._height=100,this._width=100,this.yes3d=!0,this.intRendOk=1,this._visible=!0,this._isDragPan=!1,this._activMouse=!0,this._staticShadow=!1,this._fov=45,this.alwaysRender=!1,this.AMBIEN_COLOR=\"#ffffff\",this.AMBIEN_INTENSITY=.79,this.LIGHT_COLOR=\"#ffffff\",this.LIGHT_BIAS=.001,this.SHADOW_INTENSITY=.22,this.SHADOW_RADIUS=1,this.SHADOW_WH=4096,this.DISTANCE=0,this.CUB_HEIGHT=500,this.CUB_WIDTH=500,this.FOV=45,this.FAR=45e3,this._fov=this.FOV,this.content=void 0,this.graphics=void 0,this.fun_sob=void 0,null!=_content2d&&(this.content=eval(\"new PIXI.Container()\"),this.graphics=eval(\"new PIXI.Graphics()\"),_content2d.addChild(this.content),this.content.addChild(this.graphics),this.graphics.interactive=!0),this.camera,this.scene=new THREE.Scene;var color=3160129;this.color=color,this.camera=new THREE.PerspectiveCamera(this.FOV,this._width/this._height,1,this.FAR),this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:_alpha}),this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this._width,this._height),1==_alpha?this.renderer.setClearColor(color,0):this.renderer.setClearColor(color,1),this.renderer.shadowMap.type=THREE.PCFSoftShadowMap,this.efect,this.efect=new _efect_Efect_js__WEBPACK_IMPORTED_MODULE_3__.a(this),_contentHTML.appendChild(this.renderer.domElement),this.renderer.domElement.style.zIndex=-10,this.event3DArr,1==_event3DArr&&(this.event3DArr=new _MEvent3DArr_js__WEBPACK_IMPORTED_MODULE_1__.a(this,this.camera,_contentHTML),this.scene.event3DArr=this.event3DArr,this.event3DArr.addDragEvent(this.graphics,_contentHTML),this.event3DArr.activ=this._activMouse),this.camera.position.set(0,0,-60),this.camera.rotation.set(Math.PI,0,0),this.renderer.domElement.style.position=\"fixed\",this.renderer.domElement.style.top=\"0px\",this.renderer.domElement.style.left=\"0px\",this.group=new THREE.Object3D,this.group.rotation.x=Math.PI/2,this.scene.add(this.group),this.group1=new THREE.Object3D,this.group.add(this.group1),this.group2=new THREE.Object3D,this.group1.add(this.group2),this.groupObject=new THREE.Object3D,this.group2.add(this.groupObject),this.group3d=new THREE.Object3D,this.groupObject.add(this.group3d),this.gp=new THREE.Object3D,this.gp.rotation.x=Math.PI/2,this.scene.add(this.gp),this.gp1=new THREE.Object3D,this.gp.add(this.gp1),this.gp2=new THREE.Object3D,this.gp1.add(this.gp2),this.gpObject=new THREE.Object3D,this.gp2.add(this.gpObject),this.gpObject2=new THREE.Object3D,this.gp2.add(this.gpObject2),this.gpObject.position.z=1,this.gpObject.scale.set(.001,.001,.001),this.gpObject2.position.z=1,this.gpObject2.scale.set(.001,.001,.001),this.gCGG=new THREE.Object3D,this.group.add(this.gCGG),this.gCAngel=new THREE.Object3D,this.gCGG.add(this.gCAngel),this.gCam1=new THREE.Object3D,this.gCAngel.add(this.gCam1),this.gCam2=new THREE.Object3D,this.gCam1.add(this.gCam2),this.ggCam=new THREE.Object3D,this.gCam2.add(this.ggCam),this.ggCam.add(this.camera),this.ggCam.position.z=-this._zume,this.camera.position.z=0,this.axesHelper=new THREE.AxesHelper(100),this.scene.add(this.axesHelper),this.axesHelper.visible=!1,this.arrPoint=[];var disLig=4e3,powerLig=.4,dis=1e4,bbbbbb;if(this.sunLight,this.ambientLight=new THREE.AmbientLight(this.AMBIEN_COLOR,this.AMBIEN_INTENSITY),this.scene.add(this.ambientLight),this.ambientLight.castShadow=!1,1==_directional){var sunIntensity=this.SHADOW_INTENSITY;this.sunLight=new THREE.DirectionalLight(this.LIGHT_COLOR,sunIntensity,0,0,.2),this.sunLight.position.set(0,this.DISTANCE+2*this.CUB_HEIGHT,0),this.sunLight.castShadow=!0,this.sunLight.shadow.camera.near=this.CUB_HEIGHT,this.sunLight.shadow.camera.far=this.CUB_HEIGHT+2*this.CUB_HEIGHT,this.sunLight.shadow.camera.right=this.CUB_WIDTH,this.sunLight.shadow.camera.left=-this.CUB_WIDTH,this.sunLight.shadow.camera.top=this.CUB_WIDTH,this.sunLight.shadow.camera.bottom=-this.CUB_WIDTH,this.sunLight.shadow.mapSize.width=this.SHADOW_WH,this.sunLight.shadow.mapSize.height=this.SHADOW_WH,this.sunLight.shadow.bias=this.LIGHT_BIAS,this.sunLight.shadow.radius=this.SHADOW_RADIUS}this.initOut=function(){},this.position3d=new _MPosition3d_js__WEBPACK_IMPORTED_MODULE_0__.a(self,this.graphics,this.renderer.domElement),this.utility=new _MUtility_js__WEBPACK_IMPORTED_MODULE_2__.a(self),this.arrayDoRender=[],this.arrayDoRender2=[],this.shadowNeedsUpdate=!1,this.arrFun=[],this.addFun=function(t){for(var e=0;e<this.arrFun.length;e++)if(this.arrFun[e]===t)return!1;return this.arrFun.push(t),!0},this.render=function(){if(0!=this.yes3d){if(0!=this.arrayDoRender2.length)for(var t=0;t<this.arrayDoRender2.length;t++)this.arrayDoRender2[t]();if(0!=this.arrFun.length){for(t=0;t<this.arrFun.length;t++)this.arrFun[t]();this.arrFun.length=0}if(this.utility.render(),this.intRend=10,this.shadowNeedsUpdate&&(this.shadowNeedsUpdate=!1,this.renderer.shadowMap.needsUpdate=!0),this.efect?this.efect.render():this.renderer.render(this.scene,this.camera),0!=this.arrayDoRender.length)for(t=0;t<this.arrayDoRender.length;t++)this.arrayDoRender[t]()}},this.upDate=function(){(this.alwaysRender||this.intRend==this.intRendOk)&&this.render(),this.intRend<10&&this.intRend++},this.renderer.render(this.scene,this.camera),this.sizeWindow=function(t,e,i,s){null!=t&&(this._x=t),null!=e&&(this._y=e),null!=s&&(this._height=s),null!=i&&(this._width=i),null!=this.content&&(this.content.x=this._x,this.content.y=this._y,this.graphics.clear(),this.graphics.beginFill(16711680,0),this.graphics.drawRect(0,0,this._width,this._height),this.graphics.endFill()),this.renderer.domElement.style.left=this._x+\"px\",this.renderer.domElement.style.top=this._y+\"px\",this.camera.aspect=this._width/this._height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this._width,this._height),this.intRend=1;let n=87e-5*this.camera.aspect;this.gpObject2.scale.set(n,87e-5,1),this.gpObject.scale.set(n/(this._width/1e3),87e-5/(this._height/1e3),1),this.event3DArr&&(this.event3DArr.sizeWindow(this._width,this._height),this.event3DArr.setRect(this._x,this._y,this._width,this._height)),this.efect&&this.efect.sizeWindow(this._width,this._height)},this.render(),this.sizeWindow(),this.objShadow=function(t,e){if(null==e&&(e=!0),bbbbbb=!0,t.material&&1==t.material.transparent&&t.material.opacity<1&&(bbbbbb=!1),1==bbbbbb&&(t.castShadow=e,t.receiveShadow=e),null!=t.children)for(var i=0;i<t.children.length;i++)null!=t.children?this.objShadow(t.children[i],e):(bbbbbb=!0,t.children[i].material&&1==t.material.transparent&&t.material.opacity<1&&(bbbbbb=!1),1==bbbbbb&&(t.children[i].castShadow=e,t.children[i].receiveShadow=e))},this.getObj=function(){var t={};return t.xVerh=this._xVerh,t.yVerh=this._yVerh,t.zVerh=this._zVerh,t.rotationX=this._rotationX,t.rotationZ=this._rotationZ,t.zume=this._zume,t.fov=this._fov,t},this.setObj=function(t){null!=t&&(this.xVerh=t.xVerh,this.yVerh=t.yVerh,this.zVerh=t.zVerh,this.rotationX=t.rotationX,this.rotationZ=t.rotationZ,this.zume=t.zume,this.fov=t.fov)},this.mousemove=function(t){self.position3d.stageMoveNew(t),self.event3DArr.mousemove(t)},this.getFunMouseMove=function(){return 0==self.devas?self.position3d.div.removeEventListener(\"mousemove\",self.mousemove):self.position3d.div.removeEventListener(\"touchmove\",self.mousemove),self.mousemove},null==_content2d?0==self.devas?self.position3d.div.addEventListener(\"mousemove\",self.mousemove):self.position3d.div.addEventListener(\"touchmove\",self.mousemove):(self.stageM2=function(t){self.position3d.stageMoveNew(t.data.originalEvent),self.event3DArr.mousemove(t.data.originalEvent)},0==self.devas?this.graphics.on(\"mousemove\",self.stageM2):this.graphics.on(\"touchmove\",self.stageM2)),document.oncontextmenu=function(t){return!1},this.addEvent=function(t,e){this.event3DArr&&this.event3DArr.eventSob.addEvent(t,e)},this.removeEvent=function(t,e){this.event3DArr&&this.event3DArr.eventSob.removeEvent(t,e)},this.addChildMouse=function(t){this.event3DArr&&this.event3DArr.addChild(t)},this.removeChildMouse=function(t){this.event3DArr&&this.event3DArr.removeChild(t)},this.fun_rotationX,this.fun_rotationZ,this.fun_drag=void 0}MVisi3D.prototype={set staticShadow(t){this.renderer.shadowMap.autoUpdate=!t,this._staticShadow=t},get staticShadow(){return this._staticShadow},set rotationX(t){this._rotationX!==t&&(this._rotationX=t,this.intRend=1,this.gCam2.rotation.x=t,this.gp2.rotation.x=t,this.fun_rotationX&&this.fun_rotationX(),null!=this.fun_drag&&this.fun_drag())},get rotationX(){return this._rotationX},set rotationZ(t){this._rotationZ!==t&&(this._rotationZ=t,this.gCam1.rotation.z=t,this.gp1.rotation.z=t,this.intRend=1,this.fun_rotationZ&&this.fun_rotationZ(),null!=this.fun_drag&&this.fun_drag())},get rotationZ(){return this._rotationZ},set zume(t){this._zume!==t&&(this.gpObject.position.z=1-t,this.gpObject2.position.z=1-t,this._zume=t,this.ggCam.position.z=-t,this.camera.position.z=0,this.intRend=1,null!=this.fun_drag&&this.fun_drag())},get zume(){return this._zume},set fov(t){this._fov=t,this.camera.fov=t,this.camera.updateProjectionMatrix(),null!=this.fun_drag&&this.fun_drag()},get fov(){return this._fov},set yVerh(t){this._yVerh=t,this.gCGG.position.z=t,this.intRend=1,null!=this.fun_drag&&this.fun_drag()},get yVerh(){return this.gCGG.position.z},set xVerh(t){this._xVerh=t,this.gCGG.position.x=t,this.intRend=1,null!=this.fun_drag&&this.fun_drag()},get xVerh(){return this.gCGG.position.x},set zVerh(t){this._zVerh=t,this.gCGG.position.y=t,this.intRend=1,null!=this.fun_drag&&this.fun_drag()},get zVerh(){return this.gCGG.position.y},set arrOut(t){this._arrOut=t,1!=this.alpha&&(this.efect&&this.efect.setValue(this._arrOut),this.intRend=1,null!=this.fun_drag&&this.fun_drag())},get arrOut(){return this._arrOut},set x(t){this._x=t,this.sizeWindow()},get x(){return this._x},set y(t){this._y=t,this.sizeWindow()},get y(){return this._y},set height(t){this._height=t,this.sizeWindow()},get height(){return this._height},set width(t){this._width=t,this.sizeWindow()},get width(){return this._width},set visible(t){this._visible=t,this.content.visible=t,this.renderer.domElement.style.visibility=t?\"visible\":\"hidden\"},get visible(){return this._visible},set isDragPan(t){this._isDragPan=t,this.position3d.isDragPan=t},get isDragPan(){return this._isDragPan},set activMouse(t){this._activMouse=t,this.event3DArr&&(this.event3DArr.activ=this._activMouse)},get activMouse(){return this._activMouse},set minZum(t){this.position3d.minZum=t},get minZum(){return this.position3d.minZum},set maxZum(t){this.position3d.maxZum=t},get maxZum(){return this.position3d.maxZum},set maxRotationX(t){this.position3d.minMaxX.x=t},get maxRotationX(){return this.position3d.minMaxX.x},set minRotationX(t){t<this.rotationX&&(this.rotationX=t),this.position3d.minMaxX.y=t},get minRotationX(){return this.position3d.minMaxX.y}}},function(t,e,i){\"use strict\";i.d(e,\"a\",function(){return s});i(3),i(0),i(2);function s(t,e,i){var s=this;this.parent=t,this.content2d=e,this.drag=!0,this.zdvigX=0,this.sPixi=void 0,this.div=i,this.devas=t.devas,this.pause=!1,this.minMaxX=new THREE.Vector2(0,2.5),this.zume=new THREE.Vector3(1,30,10),this.point=new THREE.Vector2(0,0),this.point1=new THREE.Vector2(0,0),this.b=0,this.minZum=0,this.maxZum=5e3,this.powerZum=50,this.distMinMaxBox=15e7,this.boolDrahXZ=!0,this.boolMouseRight=!0,this.isDragPan=t._isDragPan,this.isRotateScene=!1;var n=0;this.isIE=!1,(-1!==navigator.userAgent.indexOf(\"MSIE\")||navigator.appVersion.indexOf(\"Trident/\")>0)&&(this.isIE=!0),this.getStage=function(t){return null==t.parent?t:this.getStage(t.parent)},this.pppW=.2,this.ppp=.5,this.pTime=500,this.tween1=new TWEEN.Tween(s.parent),this.tween1.onUpdate(function(){s.parent.intRend=1}),this.tween1.easing(TWEEN.Easing.Quintic.Out),this.tween2=new TWEEN.Tween(s.parent),this.tween2.onUpdate(function(){s.parent.intRend=1}),this.tween2.easing(TWEEN.Easing.Quintic.Out),this.stageMoveNew=function(t){if(0!=s.boolDrag&&1!=s.pause&&!(0==s.drag||t&&t.buttons&&2==t.buttons&&0==s.boolMouseRight))if(t&&s.isDragPan&&h)p(t);else if(null==t.touches){if(s.isRotateScene&&t.data.originalEvent.shiftKey)s.parent.scene.rotation.y=n+.01*(t.clientX-s.point1.x),s.parent.intRend=1;else if(s.boolDrahXZ){var e=s.point.y-.01*(t.clientY-s.point1.y),i=s.point.x+.01*(t.clientX-s.point1.x);s.minMaxX.x>e&&(e=s.minMaxX.x),s.minMaxX.y<e&&(e=s.minMaxX.y),s.parent.rotationX=e,s.parent.rotationZ=i}}else if(1==t.touches.length){if(s.boolDrahXZ){s.minMaxX.x>s.parent.rotationX&&(s.parent.rotationX=s.minMaxX.x),s.minMaxX.y<s.parent.rotationX&&(s.parent.rotationX=s.minMaxX.y);e=s.point.y-.01*(t.touches[0].clientY-s.point1.y),i=s.point.x+.01*(t.touches[0].clientX-s.point1.x);s.tween1.to({rotationX:e,rotationZ:i},s.pTime).start()}}else t.touches.length>=2&&(s.pT.x=t.touches[0].clientX,s.pT.y=t.touches[0].clientY,s.pT1.x=t.touches[1].clientX,s.pT1.y=t.touches[1].clientY,0==s.distTach?(s.distTach=calc.getDistance(s.pT,s.pT1),r=0,c.set(Math.round(1*s.pT.x),Math.round(1*s.pT.y))):(a=calc.getDistance(s.pT,s.pT1),r=a-s.distTach,s.distTach=a),o=s.parent._zume-r*(s.parent._zume/100),s.zumNEW(o),p(null,Math.round(1*s.pT.x),Math.round(1*s.pT.y)))},this.pT=new THREE.Vector2(0,0),this.pT1=new THREE.Vector2(0,0);var r=0,a=0;this.boolDrag=!1,this.stageUpNew=function(t){s.boolDrag=!1,0==s.devas?window.removeEventListener(\"mouseup\",s.stageUpNew):(s.distTach=0,window.removeEventListener(\"touchend\",s.stageUpNew))},this.mouseUpp=function(t){s.parent.intRend=1};var o,h=!1;if(this.distTach=0,this.mouseDown=function(t){var e;1!=s.pause&&(0!=s.drag&&(t&&t.buttons&&2==t.buttons&&0==s.boolMouseRight||(h=!1,s.boolDrag=!0,s.distTach=0,s.point.y=s.parent.rotationX,s.point.x=s.parent.rotationZ,s.isRotateScene&&(n=s.parent.scene.rotation.y),s.isDragPan&&t&&(1===t.button||2===t.button)&&(h=!0,e=t,c.set(e.clientX,e.clientY)),0==s.devas?(s.point1.x=t.clientX,s.point1.y=t.clientY,window.addEventListener(\"mouseup\",s.stageUpNew)):(s.point1.x=t.touches[0].clientX,s.point1.y=t.touches[0].clientY,window.addEventListener(\"touchend\",s.stageUpNew)))))},this.dragscrol=void 0,this.mousewheel=function(t){if(0!=s.drag){var e=1;t.delta;null==t.wheelDelta&&t.wheelDelta,t.delta&&t.delta<0&&(e=1),t.deltaY&&t.deltaY<0&&(e=1),t.detail&&t.detail<0&&(e=1),null!=t.wheelDelta&&(e=t.wheelDelta>0?-1:1),e*=-1,o=s.parent._zume+e*(s.powerZum/100)*s.parent._zume,s.zumNEW(o),s.dragscrol&&s.dragscrol(t)}},this.zumNEW=function(t){t<s.minZum&&(t=s.minZum),t>s.maxZum&&(t=s.maxZum);var e=t;s.parent.zume=s.parent.zume+(e-s.parent.zume)*s.pppW,s.tween2.stop(),s.tween2.to({zume:e},s.pTime).start(),s.parent.intRend=1},0==s.devas){i.addEventListener(\"mousedown\",this.mouseDown);i.addEventListener(\"mousewheel\",this.mousewheel,{passive:!0}),i.addEventListener(\"DOMMouseScroll\",this.mousewheel,{passive:!0})}else i.addEventListener(\"touchstart\",this.mouseDown,{passive:!1,capture:!0});var l=new THREE.Vector3,c=new THREE.Vector2,u=new THREE.Vector2,d=new THREE.Vector2;function p(t,e,i){null!=t?u.set(t.clientX,t.clientY):u.set(e,i),d.subVectors(u,c),s.moveCamXY(d),c.copy(u)}var f=function(){var t=new THREE.Vector3;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),l.add(t)}}(),m=function(){var t=new THREE.Vector3;return function(e,i){t.setFromMatrixColumn(i,1),t.multiplyScalar(e),l.add(t)}}(),g=function(t,e){var i=s.parent.renderer.domElement;if(s.parent.camera.isPerspectiveCamera){var n=Math.max(s.parent.zume,1);n*=Math.tan(s.parent.camera.fov/2*Math.PI/180),f(2*t*n/i.clientHeight,s.parent.camera.matrixWorld),m(2*e*n/i.clientHeight,s.parent.camera.matrixWorld)}else console.warn(\"WARNING: camera neither perspective.\")};this.moveCamXY=function(t){l.set(0,0,0),s.parent.camera.updateMatrixWorld(),s.parent.scene.updateMatrixWorld(),arguments.length>1&&(t={x:arguments[0],y:arguments[1]}),g(t.x||0,t.y||0),s.parent.xVerh+=l.x,s.parent.yVerh+=-l.y,s.parent.zVerh+=l.z,s.parent.xVerh=Math.max(Math.min(s.parent.xVerh,s.distMinMaxBox),-s.distMinMaxBox),s.parent.zVerh=Math.max(Math.min(s.parent.zVerh,s.distMinMaxBox),-s.distMinMaxBox),s.parent.yVerh=Math.max(Math.min(s.parent.yVerh,s.distMinMaxBox),-s.distMinMaxBox),l.set(0,0,0)}}},function(t,e,i){\"use strict\";class s{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error(\"THREE.Pass: .render() must be implemented in derived pass.\")}dispose(){}}const n=new THREE.OrthographicCamera(-1,1,1,-1,0,1);const r=new class extends THREE.BufferGeometry{constructor(){super(),this.setAttribute(\"position\",new THREE.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute(\"uv\",new THREE.Float32BufferAttribute([0,2,0,0,2,0],2))}};class a{constructor(t){this._mesh=new THREE.Mesh(r,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,n)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class o extends s{constructor(t,e,i=null,s=null,n=null){super(),this.scene=t,this.camera=e,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new THREE.Color}render(t,e,i){const s=t.autoClear;let n,r;t.autoClear=!1,null!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(t.getClearColor(this._oldClearColor),t.setClearColor(this.clearColor)),null!==this.clearAlpha&&(n=t.getClearAlpha(),t.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:i),!0===this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),null!==this.clearColor&&t.setClearColor(this._oldClearColor),null!==this.clearAlpha&&t.setClearAlpha(n),null!==this.overrideMaterial&&(this.scene.overrideMaterial=r),t.autoClear=s}}var h={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:[\"varying vec2 vUv;\",\"void main() {\",\"\\tvUv = uv;\",\"\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\"}\"].join(\"\\n\"),fragmentShader:[\"uniform float opacity;\",\"uniform sampler2D tDiffuse;\",\"varying vec2 vUv;\",\"void main() {\",\"\\tvec4 texel = texture2D( tDiffuse, vUv );\",\"\\tgl_FragColor = opacity * texel;\",\"}\"].join(\"\\n\")};class l extends s{constructor(t,e){super(),this.textureID=void 0!==e?e:\"tDiffuse\",t instanceof THREE.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.ShaderMaterial({name:void 0!==t.name?t.name:\"unspecified\",defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new a(this.material)}render(t,e,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class c extends s{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,i){const s=t.getContext(),n=t.state;let r,a;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(r=0,a=1):(r=1,a=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),n.buffers.stencil.setClear(a),n.buffers.stencil.setLocked(!0),t.setRenderTarget(i),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(s.EQUAL,1,4294967295),n.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.buffers.stencil.setLocked(!0)}}class u extends s{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class d{constructor(t,e){if(this.renderer=t,this._pixelRatio=t.getPixelRatio(),void 0===e){const i=t.getSize(new THREE.Vector2);this._width=i.width,this._height=i.height,(e=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:THREE.HalfFloatType})).texture.name=\"EffectComposer.rt1\"}else this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name=\"EffectComposer.rt2\",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new l(h),this.copyPass.material.blending=THREE.NoBlending,this.clock=new THREE.Clock}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let i=!1;for(let e=0,s=this.passes.length;e<s;e++){const s=this.passes[e];if(!1!==s.enabled){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(e),s.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),s.needsSwap){if(i){const e=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),i.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==c&&(s instanceof c?i=!0:s instanceof u&&(i=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let t=0;t<this.passes.length;t++)this.passes[t].setSize(i,s)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class p extends s{constructor(t,e,i,s){super(),this.renderScene=e,this.renderCamera=i,this.selectedObjects=void 0!==s?s:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==t?new THREE.Vector2(t.x,t.y):new THREE.Vector2(256,256);const n=Math.round(this.resolution.x/this.downSampleRatio),r=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name=\"OutlinePass.mask\",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(t,e){const i=e.isPerspectiveCamera?\"perspective\":\"orthographic\";return t.replace(/DEPTH_TO_VIEW_Z/g,i+\"DepthToViewZ\")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,{type:THREE.HalfFloatType}),this.renderTargetDepthBuffer.texture.name=\"OutlinePass.depth\",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(n,r,{type:THREE.HalfFloatType}),this.renderTargetMaskDownSampleBuffer.texture.name=\"OutlinePass.depthDownSample\",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(n,r,{type:THREE.HalfFloatType}),this.renderTargetBlurBuffer1.texture.name=\"OutlinePass.blur1\",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(r/2),{type:THREE.HalfFloatType}),this.renderTargetBlurBuffer2.texture.name=\"OutlinePass.blur2\",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(n,r,{type:THREE.HalfFloatType}),this.renderTargetEdgeBuffer1.texture.name=\"OutlinePass.edge1\",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(n/2),Math.round(r/2),{type:THREE.HalfFloatType}),this.renderTargetEdgeBuffer2.texture.name=\"OutlinePass.edge2\",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(n,r),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(n/2),Math.round(r/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const o=h;this.copyUniforms=THREE.UniformsUtils.clone(o.uniforms),this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new a(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(t,e){this.renderTargetMaskBuffer.setSize(t,e),this.renderTargetDepthBuffer.setSize(t,e);let i=Math.round(t/this.downSampleRatio),s=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,s),this.renderTargetBlurBuffer1.setSize(i,s),this.renderTargetEdgeBuffer1.setSize(i,s),this.separableBlurMaterial1.uniforms.texSize.value.set(i,s),i=Math.round(i/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(i,s),this.renderTargetEdgeBuffer2.setSize(i,s),this.separableBlurMaterial2.uniforms.texSize.value.set(i,s)}changeVisibilityOfSelectedObjects(t){const e=this._visibilityCache;function i(i){i.isMesh&&(!0===t?i.visible=e.get(i):(e.set(i,i.visible),i.visible=t))}for(let t=0;t<this.selectedObjects.length;t++){this.selectedObjects[t].traverse(i)}}changeVisibilityOfNonSelectedObjects(t){const e=this._visibilityCache,i=[];function s(t){t.isMesh&&i.push(t)}for(let t=0;t<this.selectedObjects.length;t++){this.selectedObjects[t].traverse(s)}this.renderScene.traverse(function(s){if(s.isMesh||s.isSprite){let n=!1;for(let t=0;t<i.length;t++)if(i[t].id===s.id){n=!0;break}if(!1===n){const i=s.visible;!1!==t&&!0!==e.get(s)||(s.visible=t),e.set(s,i)}}else(s.isPoints||s.isLine)&&(!0===t?s.visible=e.get(s):(e.set(s,s.visible),s.visible=t))})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(t,e,i,s,n){if(this.selectedObjects.length>0){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const e=t.autoClear;t.autoClear=!1,n&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const s=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=s,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const t=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(t),this.tempPulseColor2.multiplyScalar(t)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=p.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=p.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=p.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=p.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,n&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(i),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=e}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,t.setRenderTarget(null),this.fsQuad.render(t))}getPrepareMaskMaterial(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:\"#include <morphtarget_pars_vertex>\\n\\t\\t\\t\\t#include <skinning_pars_vertex>\\n\\n\\t\\t\\t\\tvarying vec4 projTexCoord;\\n\\t\\t\\t\\tvarying vec4 vPosition;\\n\\t\\t\\t\\tuniform mat4 textureMatrix;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\t#include <skinbase_vertex>\\n\\t\\t\\t\\t\\t#include <begin_vertex>\\n\\t\\t\\t\\t\\t#include <morphtarget_vertex>\\n\\t\\t\\t\\t\\t#include <skinning_vertex>\\n\\t\\t\\t\\t\\t#include <project_vertex>\\n\\n\\t\\t\\t\\t\\tvPosition = mvPosition;\\n\\n\\t\\t\\t\\t\\tvec4 worldPosition = vec4( transformed, 1.0 );\\n\\n\\t\\t\\t\\t\\t#ifdef USE_INSTANCING\\n\\n\\t\\t\\t\\t\\t\\tworldPosition = instanceMatrix * worldPosition;\\n\\n\\t\\t\\t\\t\\t#endif\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\tworldPosition = modelMatrix * worldPosition;\\n\\n\\t\\t\\t\\t\\tprojTexCoord = textureMatrix * worldPosition;\\n\\n\\t\\t\\t\\t}\",fragmentShader:\"#include <packing>\\n\\t\\t\\t\\tvarying vec4 vPosition;\\n\\t\\t\\t\\tvarying vec4 projTexCoord;\\n\\t\\t\\t\\tuniform sampler2D depthTexture;\\n\\t\\t\\t\\tuniform vec2 cameraNearFar;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\n\\t\\t\\t\\t\\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\\n\\t\\t\\t\\t\\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\\n\\t\\t\\t\\t\\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\\n\\t\\t\\t\\t\\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\\n\\n\\t\\t\\t\\t}\"})}getEdgeDetectionMaterial(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:\"varying vec2 vUv;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tvUv = uv;\\n\\t\\t\\t\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\t\\t\\t\\t}\",fragmentShader:\"varying vec2 vUv;\\n\\n\\t\\t\\t\\tuniform sampler2D maskTexture;\\n\\t\\t\\t\\tuniform vec2 texSize;\\n\\t\\t\\t\\tuniform vec3 visibleEdgeColor;\\n\\t\\t\\t\\tuniform vec3 hiddenEdgeColor;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tvec2 invSize = 1.0 / texSize;\\n\\t\\t\\t\\t\\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\\n\\t\\t\\t\\t\\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\\n\\t\\t\\t\\t\\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\\n\\t\\t\\t\\t\\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\\n\\t\\t\\t\\t\\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\\n\\t\\t\\t\\t\\tfloat diff1 = (c1.r - c2.r)*0.5;\\n\\t\\t\\t\\t\\tfloat diff2 = (c3.r - c4.r)*0.5;\\n\\t\\t\\t\\t\\tfloat d = length( vec2(diff1, diff2) );\\n\\t\\t\\t\\t\\tfloat a1 = min(c1.g, c2.g);\\n\\t\\t\\t\\t\\tfloat a2 = min(c3.g, c4.g);\\n\\t\\t\\t\\t\\tfloat visibilityFactor = min(a1, a2);\\n\\t\\t\\t\\t\\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\\n\\t\\t\\t\\t\\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\\n\\t\\t\\t\\t}\"})}getSeperableBlurMaterial(t){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:\"varying vec2 vUv;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tvUv = uv;\\n\\t\\t\\t\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\t\\t\\t\\t}\",fragmentShader:\"#include <common>\\n\\t\\t\\t\\tvarying vec2 vUv;\\n\\t\\t\\t\\tuniform sampler2D colorTexture;\\n\\t\\t\\t\\tuniform vec2 texSize;\\n\\t\\t\\t\\tuniform vec2 direction;\\n\\t\\t\\t\\tuniform float kernelRadius;\\n\\n\\t\\t\\t\\tfloat gaussianPdf(in float x, in float sigma) {\\n\\t\\t\\t\\t\\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\\n\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tvec2 invSize = 1.0 / texSize;\\n\\t\\t\\t\\t\\tfloat sigma = kernelRadius/2.0;\\n\\t\\t\\t\\t\\tfloat weightSum = gaussianPdf(0.0, sigma);\\n\\t\\t\\t\\t\\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\\n\\t\\t\\t\\t\\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\\n\\t\\t\\t\\t\\tvec2 uvOffset = delta;\\n\\t\\t\\t\\t\\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\\n\\t\\t\\t\\t\\t\\tfloat x = kernelRadius * float(i) / float(MAX_RADIUS);\\n\\t\\t\\t\\t\\t\\tfloat w = gaussianPdf(x, sigma);\\n\\t\\t\\t\\t\\t\\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\\n\\t\\t\\t\\t\\t\\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\\n\\t\\t\\t\\t\\t\\tdiffuseSum += ((sample1 + sample2) * w);\\n\\t\\t\\t\\t\\t\\tweightSum += (2.0 * w);\\n\\t\\t\\t\\t\\t\\tuvOffset += delta;\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\tgl_FragColor = diffuseSum/weightSum;\\n\\t\\t\\t\\t}\"})}getOverlayMaterial(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:\"varying vec2 vUv;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tvUv = uv;\\n\\t\\t\\t\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\t\\t\\t\\t}\",fragmentShader:\"varying vec2 vUv;\\n\\n\\t\\t\\t\\tuniform sampler2D maskTexture;\\n\\t\\t\\t\\tuniform sampler2D edgeTexture1;\\n\\t\\t\\t\\tuniform sampler2D edgeTexture2;\\n\\t\\t\\t\\tuniform sampler2D patternTexture;\\n\\t\\t\\t\\tuniform float edgeStrength;\\n\\t\\t\\t\\tuniform float edgeGlow;\\n\\t\\t\\t\\tuniform bool usePatternTexture;\\n\\n\\t\\t\\t\\tvoid main() {\\n\\t\\t\\t\\t\\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\\n\\t\\t\\t\\t\\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\\n\\t\\t\\t\\t\\tvec4 maskColor = texture2D(maskTexture, vUv);\\n\\t\\t\\t\\t\\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\\n\\t\\t\\t\\t\\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\\n\\t\\t\\t\\t\\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\\n\\t\\t\\t\\t\\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\\n\\t\\t\\t\\t\\tif(usePatternTexture)\\n\\t\\t\\t\\t\\t\\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\\n\\t\\t\\t\\t\\tgl_FragColor = finalColor;\\n\\t\\t\\t\\t}\",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}p.BlurDirectionX=new THREE.Vector2(1,0),p.BlurDirectionY=new THREE.Vector2(0,1);const f={name:\"OutputShader\",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:\"\\n\\t\\tprecision highp float;\\n\\n\\t\\tuniform mat4 modelViewMatrix;\\n\\t\\tuniform mat4 projectionMatrix;\\n\\n\\t\\tattribute vec3 position;\\n\\t\\tattribute vec2 uv;\\n\\n\\t\\tvarying vec2 vUv;\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvUv = uv;\\n\\t\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\n\\t\\t}\",fragmentShader:\"\\n\\t\\n\\t\\tprecision highp float;\\n\\n\\t\\tuniform sampler2D tDiffuse;\\n\\n\\t\\t#include <tonemapping_pars_fragment>\\n\\t\\t#include <colorspace_pars_fragment>\\n\\n\\t\\tvarying vec2 vUv;\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tgl_FragColor = texture2D( tDiffuse, vUv );\\n\\n\\t\\t\\t// tone mapping\\n\\n\\t\\t\\t#ifdef LINEAR_TONE_MAPPING\\n\\n\\t\\t\\t\\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\\n\\n\\t\\t\\t#elif defined( REINHARD_TONE_MAPPING )\\n\\n\\t\\t\\t\\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\\n\\n\\t\\t\\t#elif defined( CINEON_TONE_MAPPING )\\n\\n\\t\\t\\t\\tgl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );\\n\\n\\t\\t\\t#elif defined( ACES_FILMIC_TONE_MAPPING )\\n\\n\\t\\t\\t\\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\\n\\n\\t\\t\\t#endif\\n\\n\\t\\t\\t// color space\\n\\n\\t\\t\\t#ifdef SRGB_TRANSFER\\n\\n\\t\\t\\t\\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\\n\\n\\t\\t\\t#endif\\n\\n\\t\\t}\"};class m extends s{constructor(){super();const t=f;this.uniforms=THREE.UniformsUtils.clone(t.uniforms),this.material=new THREE.RawShaderMaterial({name:t.name,uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new a(this.material),this._outputColorSpace=null,this._toneMapping=null}render(t,e,i){this.uniforms.tDiffuse.value=i.texture,this.uniforms.toneMappingExposure.value=t.toneMappingExposure,this._outputColorSpace===t.outputColorSpace&&this._toneMapping===t.toneMapping||(this._outputColorSpace=t.outputColorSpace,this._toneMapping=t.toneMapping,this.material.defines={},THREE.ColorManagement.getTransfer(this._outputColorSpace)===THREE.SRGBTransfer&&(this.material.defines.SRGB_TRANSFER=\"\"),this._toneMapping===THREE.LinearToneMapping?this.material.defines.LINEAR_TONE_MAPPING=\"\":this._toneMapping===THREE.ReinhardToneMapping?this.material.defines.REINHARD_TONE_MAPPING=\"\":this._toneMapping===THREE.CineonToneMapping?this.material.defines.CINEON_TONE_MAPPING=\"\":this._toneMapping===THREE.ACESFilmicToneMapping&&(this.material.defines.ACES_FILMIC_TONE_MAPPING=\"\"),this.material.needsUpdate=!0),!0===this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const g={name:\"FXAAShader\",uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:\"\\n\\n\\t\\tvarying vec2 vUv;\\n\\n\\t\\tvoid main() {\\n\\n\\t\\t\\tvUv = uv;\\n\\t\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\n\\t\\t}\",fragmentShader:\"\\n\\tprecision highp float;\\n\\n\\tuniform sampler2D tDiffuse;\\n\\n\\tuniform vec2 resolution;\\n\\n\\tvarying vec2 vUv;\\n\\n\\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\\n\\n\\t//----------------------------------------------------------------------------------\\n\\t// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\\n\\t// SDK Version: v3.00\\n\\t// Email:       gameworks@nvidia.com\\n\\t// Site:        http://developer.nvidia.com/\\n\\t//\\n\\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\\n\\t//\\n\\t// Redistribution and use in source and binary forms, with or without\\n\\t// modification, are permitted provided that the following conditions\\n\\t// are met:\\n\\t//  * Redistributions of source code must retain the above copyright\\n\\t//    notice, this list of conditions and the following disclaimer.\\n\\t//  * Redistributions in binary form must reproduce the above copyright\\n\\t//    notice, this list of conditions and the following disclaimer in the\\n\\t//    documentation and/or other materials provided with the distribution.\\n\\t//  * Neither the name of NVIDIA CORPORATION nor the names of its\\n\\t//    contributors may be used to endorse or promote products derived\\n\\t//    from this software without specific prior written permission.\\n\\t//\\n\\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY\\n\\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\\n\\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\\n\\t// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\\n\\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\\n\\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\\n\\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\\n\\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\\n\\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\\n\\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\n\\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n\\t//\\n\\t//----------------------------------------------------------------------------------\\n\\n\\t#ifndef FXAA_DISCARD\\n\\t\\t\\t//\\n\\t\\t\\t// Only valid for PC OpenGL currently.\\n\\t\\t\\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\\n\\t\\t\\t//\\n\\t\\t\\t// 1 = Use discard on pixels which don't need AA.\\n\\t\\t\\t//     For APIs which enable concurrent TEX+ROP from same surface.\\n\\t\\t\\t// 0 = Return unchanged color on pixels which don't need AA.\\n\\t\\t\\t//\\n\\t\\t\\t#define FXAA_DISCARD 0\\n\\t#endif\\n\\n\\t/*--------------------------------------------------------------------------*/\\n\\t#define FxaaTexTop(t, p) texture2D(t, p, -100.0)\\n\\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)\\n\\t/*--------------------------------------------------------------------------*/\\n\\n\\t#define NUM_SAMPLES 5\\n\\n\\t// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha\\n\\tfloat contrast( vec4 a, vec4 b ) {\\n\\t\\t\\tvec4 diff = abs( a - b );\\n\\t\\t\\treturn max( max( max( diff.r, diff.g ), diff.b ), diff.a );\\n\\t}\\n\\n\\t/*============================================================================\\n\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tFXAA3 QUALITY - PC\\n\\n\\t============================================================================*/\\n\\n\\t/*--------------------------------------------------------------------------*/\\n\\tvec4 FxaaPixelShader(\\n\\t\\t\\tvec2 posM,\\n\\t\\t\\tsampler2D tex,\\n\\t\\t\\tvec2 fxaaQualityRcpFrame,\\n\\t\\t\\tfloat fxaaQualityEdgeThreshold,\\n\\t\\t\\tfloat fxaaQualityinvEdgeThreshold\\n\\t) {\\n\\t\\t\\tvec4 rgbaM = FxaaTexTop(tex, posM);\\n\\t\\t\\tvec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);\\n\\t\\t\\tvec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);\\n\\t\\t\\tvec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);\\n\\t\\t\\tvec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);\\n\\t\\t\\t// . S .\\n\\t\\t\\t// W M E\\n\\t\\t\\t// . N .\\n\\n\\t\\t\\tbool earlyExit = max( max( max(\\n\\t\\t\\t\\t\\tcontrast( rgbaM, rgbaN ),\\n\\t\\t\\t\\t\\tcontrast( rgbaM, rgbaS ) ),\\n\\t\\t\\t\\t\\tcontrast( rgbaM, rgbaE ) ),\\n\\t\\t\\t\\t\\tcontrast( rgbaM, rgbaW ) )\\n\\t\\t\\t\\t\\t< fxaaQualityEdgeThreshold;\\n\\t\\t\\t// . 0 .\\n\\t\\t\\t// 0 0 0\\n\\t\\t\\t// . 0 .\\n\\n\\t\\t\\t#if (FXAA_DISCARD == 1)\\n\\t\\t\\t\\t\\tif(earlyExit) FxaaDiscard;\\n\\t\\t\\t#else\\n\\t\\t\\t\\t\\tif(earlyExit) return rgbaM;\\n\\t\\t\\t#endif\\n\\n\\t\\t\\tfloat contrastN = contrast( rgbaM, rgbaN );\\n\\t\\t\\tfloat contrastS = contrast( rgbaM, rgbaS );\\n\\t\\t\\tfloat contrastE = contrast( rgbaM, rgbaE );\\n\\t\\t\\tfloat contrastW = contrast( rgbaM, rgbaW );\\n\\n\\t\\t\\tfloat relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );\\n\\t\\t\\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\\n\\n\\t\\t\\tbool horzSpan = relativeVContrast > 0.;\\n\\t\\t\\t// . 1 .\\n\\t\\t\\t// 0 0 0\\n\\t\\t\\t// . 1 .\\n\\n\\t\\t\\t// 45 deg edge detection and corners of objects, aka V/H contrast is too similar\\n\\t\\t\\tif( abs( relativeVContrast ) < .3 ) {\\n\\t\\t\\t\\t\\t// locate the edge\\n\\t\\t\\t\\t\\tvec2 dirToEdge;\\n\\t\\t\\t\\t\\tdirToEdge.x = contrastE > contrastW ? 1. : -1.;\\n\\t\\t\\t\\t\\tdirToEdge.y = contrastS > contrastN ? 1. : -1.;\\n\\t\\t\\t\\t\\t// . 2 .      . 1 .\\n\\t\\t\\t\\t\\t// 1 0 2  ~=  0 0 1\\n\\t\\t\\t\\t\\t// . 1 .      . 0 .\\n\\n\\t\\t\\t\\t\\t// tap 2 pixels and see which ones are \\\"outside\\\" the edge, to\\n\\t\\t\\t\\t\\t// determine if the edge is vertical or horizontal\\n\\n\\t\\t\\t\\t\\tvec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);\\n\\t\\t\\t\\t\\tfloat matchAlongH = contrast( rgbaM, rgbaAlongH );\\n\\t\\t\\t\\t\\t// . 1 .\\n\\t\\t\\t\\t\\t// 0 0 1\\n\\t\\t\\t\\t\\t// . 0 H\\n\\n\\t\\t\\t\\t\\tvec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);\\n\\t\\t\\t\\t\\tfloat matchAlongV = contrast( rgbaM, rgbaAlongV );\\n\\t\\t\\t\\t\\t// V 1 .\\n\\t\\t\\t\\t\\t// 0 0 1\\n\\t\\t\\t\\t\\t// . 0 .\\n\\n\\t\\t\\t\\t\\trelativeVContrast = matchAlongV - matchAlongH;\\n\\t\\t\\t\\t\\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\\n\\n\\t\\t\\t\\t\\tif( abs( relativeVContrast ) < .3 ) { // 45 deg edge\\n\\t\\t\\t\\t\\t\\t\\t// 1 1 .\\n\\t\\t\\t\\t\\t\\t\\t// 0 0 1\\n\\t\\t\\t\\t\\t\\t\\t// . 0 1\\n\\n\\t\\t\\t\\t\\t\\t\\t// do a simple blur\\n\\t\\t\\t\\t\\t\\t\\treturn mix(\\n\\t\\t\\t\\t\\t\\t\\t\\t\\trgbaM,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t(rgbaN + rgbaS + rgbaE + rgbaW) * .25,\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t.4\\n\\t\\t\\t\\t\\t\\t\\t);\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\thorzSpan = relativeVContrast > 0.;\\n\\t\\t\\t}\\n\\n\\t\\t\\tif(!horzSpan) rgbaN = rgbaW;\\n\\t\\t\\tif(!horzSpan) rgbaS = rgbaE;\\n\\t\\t\\t// . 0 .      1\\n\\t\\t\\t// 1 0 1  ->  0\\n\\t\\t\\t// . 0 .      1\\n\\n\\t\\t\\tbool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );\\n\\t\\t\\tif(!pairN) rgbaN = rgbaS;\\n\\n\\t\\t\\tvec2 offNP;\\n\\t\\t\\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\\n\\t\\t\\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\\n\\n\\t\\t\\tbool doneN = false;\\n\\t\\t\\tbool doneP = false;\\n\\n\\t\\t\\tfloat nDist = 0.;\\n\\t\\t\\tfloat pDist = 0.;\\n\\n\\t\\t\\tvec2 posN = posM;\\n\\t\\t\\tvec2 posP = posM;\\n\\n\\t\\t\\tint iterationsUsed = 0;\\n\\t\\t\\tint iterationsUsedN = 0;\\n\\t\\t\\tint iterationsUsedP = 0;\\n\\t\\t\\tfor( int i = 0; i < NUM_SAMPLES; i++ ) {\\n\\t\\t\\t\\t\\titerationsUsed = i;\\n\\n\\t\\t\\t\\t\\tfloat increment = float(i + 1);\\n\\n\\t\\t\\t\\t\\tif(!doneN) {\\n\\t\\t\\t\\t\\t\\t\\tnDist += increment;\\n\\t\\t\\t\\t\\t\\t\\tposN = posM + offNP * nDist;\\n\\t\\t\\t\\t\\t\\t\\tvec4 rgbaEndN = FxaaTexTop(tex, posN.xy);\\n\\t\\t\\t\\t\\t\\t\\tdoneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );\\n\\t\\t\\t\\t\\t\\t\\titerationsUsedN = i;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif(!doneP) {\\n\\t\\t\\t\\t\\t\\t\\tpDist += increment;\\n\\t\\t\\t\\t\\t\\t\\tposP = posM - offNP * pDist;\\n\\t\\t\\t\\t\\t\\t\\tvec4 rgbaEndP = FxaaTexTop(tex, posP.xy);\\n\\t\\t\\t\\t\\t\\t\\tdoneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );\\n\\t\\t\\t\\t\\t\\t\\titerationsUsedP = i;\\n\\t\\t\\t\\t\\t}\\n\\n\\t\\t\\t\\t\\tif(doneN || doneP) break;\\n\\t\\t\\t}\\n\\n\\n\\t\\t\\tif ( !doneP && !doneN ) return rgbaM; // failed to find end of edge\\n\\n\\t\\t\\tfloat dist = min(\\n\\t\\t\\t\\t\\tdoneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,\\n\\t\\t\\t\\t\\tdoneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.\\n\\t\\t\\t);\\n\\n\\t\\t\\t// hacky way of reduces blurriness of mostly diagonal edges\\n\\t\\t\\t// but reduces AA quality\\n\\t\\t\\tdist = pow(dist, .5);\\n\\n\\t\\t\\tdist = 1. - dist;\\n\\n\\t\\t\\treturn mix(\\n\\t\\t\\t\\t\\trgbaM,\\n\\t\\t\\t\\t\\trgbaN,\\n\\t\\t\\t\\t\\tdist * .5\\n\\t\\t\\t);\\n\\t}\\n\\n\\tvoid main() {\\n\\t\\t\\tconst float edgeDetectionQuality = .2;\\n\\t\\t\\tconst float invEdgeDetectionQuality = 1. / edgeDetectionQuality;\\n\\n\\t\\t\\tgl_FragColor = FxaaPixelShader(\\n\\t\\t\\t\\t\\tvUv,\\n\\t\\t\\t\\t\\ttDiffuse,\\n\\t\\t\\t\\t\\tresolution,\\n\\t\\t\\t\\t\\tedgeDetectionQuality, // [0,1] contrast needed, otherwise early discard\\n\\t\\t\\t\\t\\tinvEdgeDetectionQuality\\n\\t\\t\\t);\\n\\n\\t}\\n\\t\"};i.d(e,\"a\",function(){return v});class v{constructor(t){let e,i,s;this._width=100,this._height=100,this.par=t,e=new d(this.par.renderer);const n=new o(this.par.scene,this.par.camera);e.addPass(n),s=new p(new THREE.Vector2(window.innerWidth,window.innerHeight),this.par.scene,this.par.camera),e.addPass(s);const r=new m;e.addPass(r),(i=new l(g)).uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),e.addPass(i),this.setValue=function(t){1!=Array.isArray(t)?s.selectedObjects=null!=t||null!=t?[t]:[]:s.selectedObjects=t},this.sizeWindow=function(t,s){this._width=t,this._height=s,e.setSize(t,s),i.uniforms.resolution.value.set(1/t,1/s)},this.render=function(){return e.render(),!0}}}},function(t,e,i){\"use strict\";function s(){this.event=void 0,this.arrSobName=[\"up\",\"down\",\"move\",\"out\",\"over\",\"wheel\"],this.arrSob=[[],[],[],[],[],[]],this.pozSob=void 0,this.dispatcherEvent=function(t,e){for(var i=0;i<this.arrSobName.length;i++)if(this.arrSobName[i]==t){e&&(e.type=t);for(var s=0;s<this.arrSob[i].length;s++)this.arrSob[i][s](e)}},this.removeEvent=function(t,e){for(var i=0;i<this.arrSobName.length;i++)if(this.arrSobName[i]==t)for(var s=0;s<this.arrSob[i].length;s++)this.arrSob[i][s]==e&&this.arrSob[i].splice(s,1)},this.addEvent=function(t,e){for(var i=0;i<this.arrSobName.length;i++)this.arrSobName[i]==t&&this.arrSob[i].push(e)}}function n(){this.target=void 0,this.face=void 0,this.point=void 0,this.faceIndex=void 0,this.type=void 0,this.uv=void 0,this.originalEvent=void 0,this.copy=function(){var t=new n;return t.target=this.target,t.face=this.face,t.point=this.point,t.faceIndex=this.faceIndex,t.type=this.type,t.uv=this.uv,t.originalEvent=this.originalEvent,t}}function r(t,e,i,r){this.parent=t;var a,o,h=this;this.camera=e,this.raycaster=new THREE.Raycaster,this.intersects,this.devas=t.devas,this.point=new THREE.Vector2(0,0),this.pointWH=new THREE.Vector2(0,0),this.arrChild=[],this.uuid=\"nullMy\",this.obj3d,this.eventSob=new s,this.event3D=new n,this.xzNull=\"xzNull\",this.poiskName=\"xzPoisk\",this.tokoName=\"null\",this._activ=!0,this.rect={x:0,y:0,width:100,height:100},this.cont=void 0,this.div=void 0,this.setRect=function(t,e,i,s){this.rect.x=t,this.rect.y=e,this.rect.width=i,this.rect.height=s},this.removeChild=function(t){a=null;for(var e=0;e<this.arrChild.length;e++)t.uuid==this.arrChild[e].uuid&&(a=this.arrChild.splice(e,1),(e-=1)<0&&(e=0));return a},this.addChild=function(t){this.removeChild(t),this.arrChild.push(t)},this.boolNum=-1,this.boolNumOld=-1,this.event,this.mouseRay=function(){0!=this._activ&&(this.rayPusk(),this.boolNum=this.getGoodParam(),-1==this.boolNum?\"nullMy\"!=this.uuid&&(this.eventSob.dispatcherEvent(\"out\",this.event3D),this.uuid=\"nullMy\"):\"nullMy\"!=this.uuid?this.uuid!=this.intersects[this.boolNum].object.uuid?(this.eventSob.dispatcherEvent(\"out\",this.event3D),this.uuid=this.intersects[this.boolNum].object.uuid,this.event3D.target=this.intersects[this.boolNum].object,this.event3D.face=this.intersects[this.boolNum].face,this.event3D.point=this.intersects[this.boolNum].point,this.event3D.faceIndex=this.intersects[this.boolNum].faceIndex,this.event3D.uv=this.intersects[this.boolNum].uv,this.event3D.originalEvent=h.event,this.eventSob.dispatcherEvent(\"over\",this.event3D)):(this.event3D.face=this.intersects[this.boolNum].face,this.event3D.point=this.intersects[this.boolNum].point,this.event3D.faceIndex=this.intersects[this.boolNum].faceIndex,this.event3D.uv=this.intersects[this.boolNum].uv,this.event3D.originalEvent=h.event,this.eventSob.dispatcherEvent(\"move\",this.event3D)):(this.uuid=this.intersects[this.boolNum].object.uuid,this.event3D.target=this.intersects[this.boolNum].object,this.event3D.face=this.intersects[this.boolNum].face,this.event3D.point=this.intersects[this.boolNum].point,this.event3D.faceIndex=this.intersects[this.boolNum].faceIndex,this.event3D.uv=this.intersects[this.boolNum].uv,this.event3D.originalEvent=h.event,this.eventSob.dispatcherEvent(\"over\",this.event3D)),this.boolNumOld=this.boolNum)},this.getPosition=function(t){var e=this.poiskName;if(this.poiskName=null!=t?t:\"xzPoisk\",this.restartPoint(),this.rayPusk(),this.poiskName=e,0!=this.intersects.length){var i=this.intersects.length-1;return-1==i&&(i=0),this.intersects[i]}return null};var l=new n;this.getNameEvent=function(t){if(this.restartPoint(),this.rayPusk(),0!=this.intersects.length)for(var e=0;e<this.intersects.length;e++)if(null!=this.intersects[e].object.parent&&this.intersects[e].object.name==t)return l.target=this.intersects[this.boolNum].object,l.face=this.intersects[this.boolNum].face,l.point=this.intersects[this.boolNum].point,l.faceIndex=this.intersects[this.boolNum].faceIndex,l.uv=this.intersects[this.boolNum].uv,l.originalEvent=h.event,l;return null},this.testVisiParam=function(t){return 0!=t.visible&&(!t.notEvent&&(null!=t.parent?this.testVisiParam(t.parent):\"Scene\"==t.type))},this.getGoodParam=function(){if(0!=this.intersects.length){var t;for(t=0;t<this.intersects.length;t++)0!=this.testVisiParam(this.intersects[t].object)&&null!=this.intersects[t].object.notActiv&&(this.intersects.splice(t,1),t=0);if(0==this.intersects.length)return-1;for(t=0;t<this.intersects.length;t++)if(0!=this.testVisiParam(this.intersects[t].object)&&this.intersects[t].object.name==this.poiskName)return t;for(t=0;t<this.intersects.length;t++)if(0!=this.testVisiParam(this.intersects[t].object)&&this.intersects[t].object.name!=this.xzNull)return t}return-1},this.rayPusk=function(){(o=new THREE.Vector3).setFromMatrixPosition(this.camera.matrixWorld),this.raycaster.ray.origin.copy(o),this.raycaster.ray.direction.set(this.point.x,this.point.y,.5).unproject(this.camera).sub(o).normalize(),this.intersects=this.raycaster.intersectObjects(this.arrChild,!0)},this.naCont=!1,this.mousemove=function(t){0==h.devas&&0==h.naCont||(null!=t.data?h.event=t.data.originalEvent:h.event=t,0!=h._activ&&(h.restartPoint(t),h.mouseRay(),h.intersects.length&&0==h.devas&&h.event.preventDefault()))},this.zdvigX=0,this.scale=1,this.pV=new THREE.Vector2(0,0);var c={x:0,y:0};this.restartPoint=function(t){t&&t.target&&(c=t.target.getBoundingClientRect()),0==h.devas?(h.pV.x=t.clientX,h.pV.y=t.clientY):(h.pV.x=t.touches[0].clientX,h.pV.y=t.touches[0].clientY),h.pV.x-=c.x,h.pV.y-=c.y,1==h.isRect(h.pV)?(h.point.x=-(this.rect.x-h.pV.x)/this.rect.width*2-1,h.point.y=-(-(this.rect.y-h.pV.y)/this.rect.height*2-1)):99999!=h.point.x&&(h.point.x=99999)},this.isRect=function(t){return t.x>=this.rect.x&&t.x<=this.rect.x+this.rect.width&&t.y>=this.rect.y&&t.y<=this.rect.y+this.rect.height},this.mouseup=function(t){null!=t.data?h.event=t.data.originalEvent:h.event=t,h.intersects&&0!=h._activ&&(0==h.devas?(-1==h.boolNumOld?(h.event3D.target=null,h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"up\",h.event3D)):(h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"up\",h.event3D)),h.intersects.length&&h.event.preventDefault()):(h.mouseRay(),-1==h.boolNumOld?(h.event3D.target=null,h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"up\",h.event3D)):(h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"up\",h.event3D),h.uuid=\"nullMy\")))},this.mousedown=function(t){null!=t.data?h.event=t.data.originalEvent:h.event=t,h.restartPoint(t),0!=h._activ&&(0==h.devas?(-1==h.boolNumOld?(h.event3D.target=null,h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"down\",h.event3D)):(h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"down\",h.event3D)),h.intersects.length&&h.event.preventDefault()):(h.mouseRay(),-1==h.boolNumOld?(h.event3D.target=null,h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"down\",h.event3D)):(h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"down\",h.event3D))))},this.mouseout=function(t){h.naCont=!1,h.restartPoint(t),h.point.x=99999,h.mouseRay()},this.mouseover=function(t){h.naCont=!0,h.restartPoint(t),h.mouseRay()},this.touchend=function(t){},this.mousewheel=function(t){null!=t.data?h.event=t.data.originalEvent:h.event=t,h.restartPoint(t),0!=h._activ&&(-1==h.boolNumOld?h.eventSob.dispatcherEvent(\"down\",null):(h.event3D.originalEvent=h.event,h.eventSob.dispatcherEvent(\"wheel\",t)))},this.addDragEvent=function(t,e){this.cont=t,this.div=e,0==h.devas?(window.addEventListener(\"mouseup\",h.mouseup),e.addEventListener(\"mousedown\",h.mousedown),e.addEventListener(\"mouseout\",h.mouseout),e.addEventListener(\"mouseover\",h.mouseover)):(window.addEventListener(\"touchend\",h.mouseup),e.addEventListener(\"touchstart\",h.mousedown))},this.sizeWindow=function(t,e){this.pointWH.x=t,this.pointWH.y=e}}i.d(e,\"a\",function(){return r}),r.prototype={set activ(t){this._activ!=t&&(this._activ=t)},get activ(){return this._activ}}},function(t,e,i){\"use strict\";i.r(e),function(t){var s=i(1);i.d(e,\"Main\",function(){return s.a}),t.Main=s.a}.call(this,i(9))},function(t,e){var i;i=function(){return this}();try{i=i||new Function(\"return this\")()}catch(t){\"object\"==typeof window&&(i=window)}t.exports=i}]);","extractedComments":[]}